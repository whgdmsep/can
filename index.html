<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ë•ê³¼ êµìœ¡ê³¼ì • - Knowledge Universe</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            /* Background & UI */
            --bg-color: #1A1C2E;
            --panel-bg: rgba(26, 28, 46, 0.95);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;

            /* Vivid Node Colors */
            --root-color: #ffffff;
            --area-1: #FF007F;
            /* Vivid Rose */
            --area-2: #FFFF00;
            /* Vivid Yellow */
            --area-3: #00FFFF;
            /* Vivid Cyan */
            --area-4: #BF00FF;
            /* Vivid Purple */

            /* Volume Colors for badges/accents */
            --vol-1: #38bdf8;
            --vol-2: #f87171;

            --glass-border: rgba(255, 255, 255, 0.15);
        }

        * {
            box-sizing: border-box;
            font-family: 'Pretendard', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- TABS --- */
        .main-tabs {
            height: 50px;
            background: #151725;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            gap: 10px;
        }

        .tab-item {
            padding: 12px 24px;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 800;
            font-size: 1.1rem;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }

        .tab-item:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-item.active {
            color: var(--vol-1);
            border-bottom-color: var(--vol-1);
            background: rgba(56, 189, 248, 0.1);
        }

        /* --- VIEWS --- */
        .main-view {
            flex: 1;
            display: none;
            overflow: hidden;
            width: 100%;
            height: calc(100vh - 50px);
        }

        .main-view.active {
            display: flex;
        }

        /* --- PLAN TABLES --- */
        .plan-container {
            width: 100%;
            height: 100%;
            padding: 40px;
            background: var(--bg-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .paper {
            width: 100%;
            max-width: 1000px;
            background: white;
            color: #000;
            padding: 50px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }

        .paper h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 30px;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            color: #000;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #000;
            padding: 10px;
            font-size: 0.9rem;
            vertical-align: middle;
        }

        .data-table th {
            background: #f0f0f0;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }

        .data-table td {
            word-break: keep-all;
        }

        .action-bar {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 1000px;
            justify-content: center;
            align-items: stretch;
        }

        .action-bar>* {
            flex: 1 1 200px;
            display: flex;
        }

        .action-bar .action-btn {
            width: 100%;
            justify-content: center;
            white-space: nowrap;
        }

        .action-btn {
            background: var(--vol-1);
            color: #000;
            border: none;
            padding: 12px 24px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        #graph-container {
            width: 60%;
            height: 100%;
            position: relative;
            background: radial-gradient(circle at 50% 50%, #2a2d45 0%, #1A1C2E 80%);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            min-height: 300px;
        }

        .graph-header {
            position: absolute;
            top: 30px;
            left: 30px;
            pointer-events: none;
            z-index: 10;
        }

        .graph-header h1 {
            margin: 0;
            font-size: 2.2rem;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            font-weight: 800;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .graph-header p {
            margin: 5px 0 0;
            color: var(--text-secondary);
            font-size: 1rem;
            letter-spacing: 1px;
        }

        /* --- RIGHT: LIST AREA (40%) --- */
        #list-container {
            width: 40%;
            height: 100%;
            background: var(--panel-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.3);
            border-left: 1px solid rgba(255, 255, 255, 0.05);
        }

        .list-header {
            padding: 25px;
            border-bottom: 1px solid var(--glass-border);
            background: rgba(40, 44, 65, 0.4);
            backdrop-filter: blur(5px);
        }

        .search-box {
            position: relative;
            margin-bottom: 15px;
        }

        .search-box input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border-radius: 14px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1.1rem;
            outline: none;
            transition: all 0.2s;
        }

        .search-box input:focus {
            border-color: var(--vol-1);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: var(--vol-1);
            color: #1A1C2E;
            font-weight: 700;
            border-color: var(--vol-1);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
        }

        .filter-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
        }

        .chatbot-notice {
            margin-top: 15px;
            padding: 10px 15px;
            background: rgba(56, 189, 248, 0.1);
            border-left: 3px solid var(--vol-1);
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--vol-1);
            font-weight: 500;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- TOOLTIP --- */
        #graph-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid #FFD700;
            pointer-events: none;
            z-index: 1000;
            max-width: 350px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.3);
            display: none;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        #graph-tooltip .tooltip-code {
            font-weight: 800;
            color: #FFD700;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        #graph-tooltip .tooltip-def {
            color: #e2e8f0;
            word-break: keep-all;
        }

        #result-area {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        #result-area::-webkit-scrollbar {
            width: 8px;
        }

        #result-area::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 4px;
        }

        /* --- BASKET AREA --- */
        #basket-area {
            height: 250px;
            background: rgba(15, 17, 26, 0.98);
            border-top: 1px solid var(--vol-1);
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
            z-index: 30;
        }

        .basket-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #basket-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-right: 5px;
        }

        #basket-list::-webkit-scrollbar {
            width: 6px;
        }

        #basket-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .basket-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 14px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #cbd5e1;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s;
        }

        .basket-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--vol-1);
            transform: translateX(3px);
        }

        .b-code {
            font-weight: 700;
            color: var(--vol-1);
            margin-right: 8px;
        }

        .b-del {
            color: #ef4444;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: bg 0.2s;
        }

        .b-del:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            padding: 22px;
            transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .card:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-3px);
            border-color: var(--vol-1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .card-code {
            font-weight: 800;
            color: var(--vol-1);
            font-size: 1rem;
            letter-spacing: 0.02em;
        }

        .card-vol {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
            font-weight: 600;
        }

        .card-def {
            font-size: 1.05rem;
            line-height: 1.6;
            color: #e2e8f0;
            margin-bottom: 16px;
            word-break: keep-all;
        }

        .card-res {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-top: 14px;
            border-top: 1px dashed rgba(255, 255, 255, 0.15);
            font-size: 0.9rem;
            color: #c7d2fe;
            flex-wrap: wrap;
        }

        .float-controls {
            position: absolute;
            bottom: 270px;
            right: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 20;
        }

        .f-btn {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: #fff;
            color: #1A1C2E;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s, background 0.2s;
        }

        .f-btn:hover {
            transform: scale(1.15);
            background: var(--vol-1);
            color: #fff;
        }

        .hl {
            background: rgba(56, 189, 248, 0.3);
            color: white;
            padding: 0 2px;
            border-radius: 2px;
        }

        .media-badge {
            padding: 3px 10px;
            border-radius: 14px;
            font-size: 0.75rem;
            color: #0f172a;
            font-weight: 800;
            margin-left: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
                height: auto;
            }

            .main-tabs {
                position: sticky;
                top: 0;
                z-index: 1000;
                overflow-x: auto;
                white-space: nowrap;
                padding: 0 10px;
            }

            .main-view {
                height: auto;
                display: none;
                flex-direction: column;
            }

            .main-view.active {
                display: flex;
            }

            /* EXPLORE VIEW MOBILE */
            #view-explore {
                flex-direction: column;
            }

            #graph-container {
                width: 100%;
                height: 50vh;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            #list-container {
                width: 100%;
                height: auto;
                box-shadow: none;
                border-left: none;
                padding-bottom: 20px;
            }

            .list-header {
                padding: 15px;
            }

            .search-box input {
                padding: 12px 15px 12px 45px;
                font-size: 1rem;
            }

            #result-area {
                max-height: 60vh;
                overflow-y: auto;
            }

            #basket-area {
                height: 300px;
                /* Give more space for basket on mobile */
                position: sticky;
                bottom: 0;
            }

            .float-controls {
                bottom: 320px;
            }

            /* PLAN VIEWS MOBILE */
            .plan-container {
                padding: 15px;
            }

            .paper {
                padding: 20px 15px;
            }

            .paper h2 {
                font-size: 1.5rem;
            }

            .data-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .action-bar {
                flex-direction: column;
                width: 100%;
                gap: 12px;
                padding: 0;
            }

            .action-bar>* {
                flex: none;
                width: 100% !important;
            }

            .action-btn,
            .ws-dropdown-container,
            .ws-dropdown-container .action-btn {
                width: 100% !important;
                flex: none;
                justify-content: center;
            }

            .close-btn {
                position: static !important;
                margin-bottom: 15px;
                width: 100%;
                justify-content: center;
            }
        }

        .data-table tr:hover td {
            background-color: #f8fafc;
        }

        .data-table [contenteditable="true"]:focus {
            outline: 2px solid var(--vol-1);
            background: #fff !important;
        }

        .reading-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .badge-facts {
            background: #e0f2fe;
            color: #0369a1;
        }

        .badge-argument {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-appreciation {
            background: #fef3c7;
            color: #92400e;
        }

        .activity-example {
            background: rgba(255, 255, 255, 0.7);
            padding: 12px;
            border-radius: 8px;
            border: 1px dashed var(--vol-1);
            color: #1a1c2e;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .activity-example strong {
            color: var(--vol-1);
            font-weight: 800;
        }

        /* Responsive adjustments for the new view */
        /* Activity Modal Styles */
        #activity-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: #fff;
            color: #1a1c2e;
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            padding: 20px 30px;
            background: #1a1c2e;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 800;
        }

        .modal-info-bar {
            background: #f1f5f9;
            padding: 12px 30px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
            color: #64748b;
        }

        .modal-body {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: #fff;
        }

        .modal-footer {
            padding: 20px 30px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .strategy-tag {
            display: inline-block;
            cursor: pointer;
            color: #0369a1;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s;
            text-decoration: underline;
        }

        .strategy-tag:hover {
            background: #e0f2fe;
            color: #0284c7;
        }

        .activity-placeholder {
            text-align: center;
            padding: 50px 20px;
        }

        .activity-placeholder i {
            color: var(--vol-1);
            margin-bottom: 20px;
        }

        .activity-placeholder p {
            font-size: 1.1rem;
            color: #475569;
            line-height: 1.6;
        }

        /* --- PRINT WORKSHEET STYLES --- */
        @media print {
            body {
                background: white !important;
                overflow: visible !important;
                width: auto !important;
                height: auto !important;
            }

            .main-tabs,
            .action-bar,
            .close-btn,
            #activity-modal,
            #graph-container,
            #list-container,
            .main-view:not(#view-worksheet),
            #instructional-design-table {
                display: none !important;
            }

            #view-worksheet,
            #worksheet-print-area {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .no-print {
                display: none !important;
            }
        }

        #worksheet-print-area {
            display: none;
            background: #fff;
            color: #1e293b;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            font-size: 11pt;
        }

        .ws-header {
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .ws-title {
            font-size: 2rem;
            font-weight: 800;
            text-align: center;
            margin: 0 0 20px 0;
            color: #000;
        }

        .ws-meta-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 10px;
        }

        .ws-student-box {
            border: 1px solid #cbd5e1;
            padding: 8px 15px;
            display: flex;
            gap: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .ws-section {
            margin-bottom: 35px;
            page-break-inside: avoid;
        }

        .ws-section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 800;
            color: #000;
            margin-bottom: 15px;
            border-left: 5px solid var(--vol-1);
            padding-left: 12px;
        }

        .ws-content-box {
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: #fcfcfc;
        }

        .ws-label {
            display: block;
            font-weight: 700;
            color: #475569;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .ws-text {
            min-height: 20px;
            line-height: 1.6;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        /* --- DROPDOWN MENU --- */
        .ws-dropdown-container {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .ws-dropdown-menu {
            display: none;
            position: absolute;
            top: 50%;
            left: calc(100% + 12px);
            transform: translateY(-50%);
            background: #ffffff;
            border: 2px solid #0f172a;
            border-radius: 12px;
            box-shadow: 10px 10px 25px -5px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 220px;
            overflow: hidden;
            display: none;
            /* Initially hidden */
            flex-direction: column;
            animation: slideInRight 0.2s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translate(-10px, -50%);
            }

            to {
                opacity: 1;
                transform: translate(0, -50%);
            }
        }

        .ws-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            cursor: pointer;
            transition: all 0.2s;
            color: #0f172a;
            border: none;
            background: none;
            white-space: nowrap;
            font-family: inherit;
            width: 100%;
        }

        .ws-dropdown-item i {
            width: 18px;
            height: 18px;
            color: #2563eb;
        }

        .ws-dropdown-item span {
            font-weight: 800;
            font-size: 0.85rem;
        }

        .ws-dropdown-item:hover {
            background: #f1f5f9;
        }

        .ws-dropdown-item:active {
            background: #e2e8f0;
        }

        .ws-dropdown-divider {
            width: 100%;
            height: 2px;
            background: #e2e8f0;
            margin: 0;
        }

        .ws-dropdown-item:hover i,
        .ws-dropdown-item:hover span {
            color: #1e40af;
        }

        /* --- TOOLTIP & GUIDE TEXT --- */
        .ws-guide-text {
            font-size: 0.8rem;
            color: #64748b;
            margin-right: 12px;
            font-weight: 500;
        }

        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip-text {
            visibility: hidden;
            width: 320px;
            background-color: #0f172a;
            color: #fff;
            text-align: left;
            border-radius: 12px;
            padding: 16px;
            position: absolute;
            z-index: 2100;
            top: calc(100% + 12px);
            right: 0;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.85rem;
            line-height: 1.6;
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.5);
            font-weight: 500;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(-10px);
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            bottom: 100%;
            right: 40px;
            border-width: 8px;
            border-style: solid;
            border-color: transparent transparent #0f172a transparent;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        .ws-dropdown-menu.active {
            display: flex !important;
        }

        /* --- BEST STRATEGY BADGE & GUIDE --- */
        .best-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            color: #fff;
            font-size: 0.7rem;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 12px;
            margin-bottom: 4px;
            box-shadow: 0 4px 10px rgba(234, 88, 12, 0.3);
            cursor: help;
        }

        .best-tag {
            border: 2px solid #ea580c !important;
            background: rgba(234, 88, 12, 0.05) !important;
            font-weight: 800 !important;
            color: #ea580c !important;
        }

        .recommend-reason {
            display: block;
            font-size: 0.75rem;
            color: #ea580c;
            margin-top: 4px;
            line-height: 1.4;
            font-weight: 600;
            padding-left: 8px;
            border-left: 2px solid #ea580c;
        }

        .ws-footer-guide {
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px dashed #cbd5e1;
            text-align: center;
            color: #64748b;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .ws-dropdown-menu.active {
            display: flex !important;
        }
    </style>
</head>

<body>
    <nav class="main-tabs">
        <div class="tab-item active" onclick="switchTab('explore')">ì§€ì‹ íƒí—˜</div>
        <div class="tab-item" onclick="switchTab('lesson')">ìˆ˜ì—… ê³„íšì„œ</div>
        <div class="tab-item" onclick="switchTab('assessment')">í‰ê°€ ê³„íšì„œ</div>
        <div class="tab-item" onclick="switchTab('detail-plan')">ìˆ˜ì—…ì§€ë„ì•ˆ</div>
        <div class="tab-item" onclick="window.open('index2.html', '_self')">ë…ì„œ ë„ìš°ë¯¸</div>
        <div class="tab-item" onclick="window.open('index3.html', '_self')">ìœµí•©ìˆ˜ì—…</div>
    </nav>

    <!-- VIEW 1: EXPLORE -->
    <div id="view-explore" class="main-view active">

        <div id="graph-container">
            <div class="graph-header">
                <h1>ë„ë•ê³¼ ì§€ì‹ì˜ ìš°ì£¼</h1>
                <p>Moral Knowledge Graph</p>
            </div>
            <div id="graph-tooltip"></div>
            <!-- D3 SVG appended here -->
        </div>

        <div id="list-container">
            <div class="list-header">
                <div class="search-box">
                    <i data-lucide="search" class="search-icon"></i>
                    <input type="text" id="searchInput" placeholder="ì„±ì·¨ê¸°ì¤€ ê²€ìƒ‰ (ì˜ˆ: í–‰ë³µ, ì •ì˜, í†µì¼)"
                        onkeyup="handleSearchInput()">
                </div>
                <div class="filters">
                    <button class="filter-btn active" onclick="setFilter('All')">ì „ì²´</button>
                    <button class="filter-btn" onclick="setFilter('ë„ë• 1')">ë„ë• 1</button>
                    <button class="filter-btn" onclick="setFilter('ë„ë• 2')">ë„ë• 2</button>
                    <button class="filter-btn" onclick="setFilter('HS')">ê³ ë“±í•™êµ</button>
                </div>
                <div class="chatbot-notice">
                    <i data-lucide="info" style="width:16px; height:16px;"></i>
                    <span>ì„±ì·¨ê¸°ì¤€ì„ ì„ íƒí•˜ì—¬ ë‹´ìœ¼ì‹œë©´ í•´ë‹¹ ìˆ˜ì—… ë° í‰ê°€ ê³„íšì´ ì¸ê³µì§€ëŠ¥ì— ì˜í•´ ìë™ìœ¼ë¡œ ì„¤ê³„ë©ë‹ˆë‹¤.</span>
                </div>
            </div>

            <div id="result-area">
                <!-- Cards go here -->
            </div>

            <div class="float-controls">
                <button class="f-btn" onclick="listScroll('top')" title="ë§¨ ìœ„ë¡œ"><i data-lucide="arrow-up"></i></button>
                <button class="f-btn" onclick="listScroll('bottom')" title="ë§¨ ì•„ë˜ë¡œ"><i
                        data-lucide="arrow-down"></i></button>
            </div>

            <div id="basket-area">
                <div class="basket-title">
                    <span><i data-lucide="shopping-bag" style="vertical-align:text-bottom; margin-right:8px;"></i> ìˆ˜ì—…
                        ë°”êµ¬ë‹ˆ</span>
                    <span id="basket-count"
                        style="background:var(--vol-1); padding:2px 8px; border-radius:12px; font-size:0.8rem; color:#1A1C2E;">0</span>
                </div>
                <div id="basket-list">
                    <div style="text-align:center; color:#64748b; margin-top:20px; font-size:0.9rem;">ì„±ì·¨ê¸°ì¤€ ë…¸ë“œë¥¼ í´ë¦­í•´ ë‹´ìœ¼ì„¸ìš”.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 2: LESSON PLAN -->
    <div id="view-lesson" class="main-view" style="display:none; flex-direction:column;">
        <div class="plan-container">
            <button class="close-btn" onclick="switchTab('explore')"
                style="position:absolute; top:20px; right:20px; z-index:100; background:rgba(239,68,68,0.9); color:#fff; border:none; padding:12px 24px; font-weight:700; cursor:pointer; border-radius:8px; display:flex; align-items:center; gap:8px; transition:all 0.2s; font-size:0.95rem; box-shadow:0 4px 12px rgba(239,68,68,0.3);"><i
                    data-lucide="x"></i> ê·¸ë˜í”„ë¡œ ëŒì•„ê°€ê¸°</button>
            <div class="action-bar">
                <button class="action-btn" onclick="copyTable('lesson-plan-table')"><i data-lucide="copy"></i> í‘œ ì–‘ì‹
                    ë³µì‚¬í•˜ê¸°</button>
                <button class="action-btn" onclick="downloadExcel()"><i data-lucide="download"></i> ì—‘ì…€ íŒŒì¼ë¡œ ë‚´ë ¤ë°›ê¸°</button>
                <button class="action-btn" onclick="downloadPDF('view-lesson')"
                    style="background:#ef4444; color:#fff;"><i data-lucide="file-text"></i> PDF íŒŒì¼ë¡œ ë‚´ë ¤ë°›ê¸°</button>
            </div>
            <div class="paper">
                <h2>ìˆ˜ì—… ê³„íšì„œ</h2>
                <table id="lesson-plan-table" class="data-table">
                    <thead>
                        <tr>
                            <th width="8%">ì›”</th>
                            <th width="8%">ì£¼</th>
                            <th width="20%">ë‹¨ì›ëª…</th>
                            <th width="30%">ì„±ì·¨ê¸°ì¤€</th>
                            <th width="17%">êµìˆ˜Â·í•™ìŠµ ë°©ë²•</th>
                            <th width="17%">í‰ê°€ ê³„íš</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic Content -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- VIEW 3: ASSESSMENT PLAN -->
    <div id="view-assessment" class="main-view" style="display:none; flex-direction:column;">
        <div class="plan-container">
            <button class="close-btn" onclick="switchTab('explore')"
                style="position:absolute; top:20px; right:20px; z-index:100; background:rgba(239,68,68,0.9); color:#fff; border:none; padding:12px 24px; font-weight:700; cursor:pointer; border-radius:8px; display:flex; align-items:center; gap:8px; transition:all 0.2s; font-size:0.95rem; box-shadow:0 4px 12px rgba(239,68,68,0.3);"><i
                    data-lucide="x"></i> ê·¸ë˜í”„ë¡œ ëŒì•„ê°€ê¸°</button>
            <div class="action-bar">
                <button class="action-btn" onclick="copyTable('assessment-plan-table')"><i data-lucide="copy"></i> í‘œ ì–‘ì‹
                    ë³µì‚¬í•˜ê¸°</button>
                <button class="action-btn" onclick="downloadExcel()"><i data-lucide="download"></i> ì—‘ì…€ íŒŒì¼ë¡œ ë‚´ë ¤ë°›ê¸°</button>
                <button class="action-btn" onclick="downloadPDF('view-assessment')"
                    style="background:#ef4444; color:#fff;"><i data-lucide="file-text"></i> PDF íŒŒì¼ë¡œ ë‚´ë ¤ë°›ê¸°</button>
            </div>
            <div class="paper">
                <h2>í‰ê°€ ê³„íšì„œ</h2>
                <table id="assessment-plan-table" class="data-table">
                    <thead>
                        <tr>
                            <th width="15%">í‰ê°€ ì˜ì—­</th>
                            <th width="15%">í•µì‹¬ ì—­ëŸ‰</th>
                            <th width="30%">ì„±ì·¨ê¸°ì¤€</th>
                            <th width="20%">ìˆ˜í–‰ ê³¼ì œ</th>
                            <th width="20%">ì±„ì  ê¸°ì¤€</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic Content -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- VIEW 4: DETAILED LESSON PLAN (GAGNE) -->
    <div id="view-detail-plan" class="main-view" style="display:none; flex-direction:column;">
        <div class="plan-container">
            <button class="close-btn" onclick="switchTab('explore')"
                style="position:absolute; top:20px; right:20px; z-index:100; background:rgba(239,68,68,0.9); color:#fff; border:none; padding:12px 24px; font-weight:700; cursor:pointer; border-radius:8px; display:flex; align-items:center; gap:8px; transition:all 0.2s; font-size:0.95rem; box-shadow:0 4px 12px rgba(239,68,68,0.3);"><i
                    data-lucide="x"></i> ê·¸ë˜í”„ë¡œ ëŒì•„ê°€ê¸°</button>
            <div class="action-bar">
                <button class="action-btn" onclick="copyTable('instructional-design-table')"><i data-lucide="copy"></i>
                    í‘œ ì–‘ì‹ ë³µì‚¬í•˜ê¸°</button>
                <button class="action-btn" onclick="downloadPDF('view-detail-plan')"
                    style="background:#ef4444; color:#fff;"><i data-lucide="file-text"></i> PDF íŒŒì¼ë¡œ ë‚´ë ¤ë°›ê¸°</button>

                <div class="ws-dropdown-container tooltip-container">
                    <button class="action-btn" onclick="toggleWorksheetDropdown(event)"
                        style="background:#0ea5e9; color:#fff;"><i data-lucide="download"></i> í•™ìƒìš© í•™ìŠµì§€ ë‚´ë ¤ë°›ê¸° <i
                            data-lucide="chevron-right" style="width:16px; margin-left:5px;"></i></button>
                    <div class="tooltip-text">
                        <div
                            style="font-weight:800; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:8px; margin-bottom:8px; color:#38bdf8;">
                            ì§€ë„ì•ˆì— ë…ì„œ í™œë™ì„ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ í•™ìŠµì§€ê°€ ìƒì„±ë©ë‹ˆë‹¤.</div>
                        ğŸ’¡ í™œìš© íŒ: ìˆ˜ì—… ì‚¬íƒœë³„ë¡œ ì„ íƒí•œ ë…ì„œ ì „ëµ(KWL, SQ3R ë“±)ë“¤ì´ í•œ ì¥ì˜ í•™ìŠµì§€ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. PDFë¡œ ë°›ê±°ë‚˜ í‘œ ì–‘ì‹ì„ ë³µì‚¬í•´ í•œê¸€ ë¬¸ì„œì— í™œìš©í•˜ì„¸ìš”!
                    </div>
                    <div id="ws-dropdown-menu" class="ws-dropdown-menu">
                        <button class="ws-dropdown-item" onclick="copyWorksheetTable()">
                            <i data-lucide="copy"></i>
                            <span>í‘œ ì–‘ì‹ ë³µì‚¬</span>
                        </button>
                        <div class="ws-dropdown-divider"></div>
                        <button class="ws-dropdown-item" onclick="downloadWorksheetPDF()">
                            <i data-lucide="file-text"></i>
                            <span>PDF íŒŒì¼ ë‚´ë ¤ë°›ê¸°</span>
                        </button>
                    </div>
                </div>
            </div>
            <div id="instructional-design-table"
                style="width:100%; display:flex; flex-direction:column; align-items:center;">
                <!-- Tables will be injected here for each selected standard -->
            </div>

            <!-- WORKSHEET PRINT AREA (Hidden by default) -->
            <div id="worksheet-print-area">
                <div class="ws-header">
                    <h1 class="ws-title">ë„ë•ê³¼ ë…ì„œ í™œë™ í•™ìŠµì§€</h1>
                    <div class="ws-meta-row">
                        <div id="ws-std-info" style="font-size:0.9rem; color:#475569; max-width:60%;">
                            <!-- ì„±ì·¨ê¸°ì¤€ ì •ë³´ -->
                        </div>
                        <div class="ws-student-box">
                            <span>í•™ë…„: ____</span>
                            <span>ë°˜: ____</span>
                            <span>ë²ˆí˜¸: ____</span>
                            <span>ì´ë¦„: __________</span>
                        </div>
                    </div>
                </div>
                <div id="ws-body">
                    <!-- Dynamic sections go here -->
                </div>
            </div>

            <!-- ACTIVITY MODAL -->
            <div id="activity-modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ë…ì„œ ì „ëµ í™œë™ì§€</h3>
                        <button onclick="closeActivityModal()"
                            style="background:none; border:none; color:#fff; cursor:pointer;"><i
                                data-lucide="x"></i></button>
                    </div>
                    <div class="modal-info-bar" id="modal-info">
                        <!-- Info injected here -->
                    </div>
                    <div class="modal-body" id="modal-body">
                        <!-- Activity content injected here -->
                    </div>
                    <div class="modal-footer">
                        <button class="action-btn" style="background:#64748b; color:#fff;"
                            onclick="closeActivityModal()">ë‹«ê¸°</button>
                        <button class="action-btn" id="save-activity-btn">ì§€ë„ì•ˆì— ê²°ê³¼ ë°˜ì˜í•˜ê¸°</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
    </div>

    <script>
        lucide.createIcons();

        const ttlData = `
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix edu: <http://library.school.go.kr/metadata/curriculum/> .
@prefix res: <http://library.school.go.kr/resource/> .

# --- Subject Nodes ---
edu:MiddleSchoolEthics a skos:Concept ; skos:prefLabel "ì¤‘í•™êµ ë„ë•" .

# --- Standards ---
# [ìì‹ ê³¼ì˜ ê´€ê³„]
edu:ST_9do01-01 a edu:Standard ; dc:identifier "9ë„01-01" ; edu:volume "ë„ë• 1" ; skos:definition "ìì‹ ì˜ ì‚¶ê³¼ ê°€ì¹˜ê´€ì— ëŒ€í•œ ì„±ì°°ì„ í†µí•´ ìì•„ë¥¼ ì˜¬ë°”ë¡œ ì´í•´í•˜ê³ , ì‚¶ì—ì„œ ë„ë•ì´ í•„ìš”í•œ ì´ìœ ì— ê·¼ê±°í•˜ì—¬ ë„ë•ì ì¸ ì‚¶ì— ëŒ€í•œ ì˜ì§€ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_SuperTurtle .
edu:ST_9do01-02 a edu:Standard ; dc:identifier "9ë„01-02" ; edu:volume "ë„ë• 1" ; skos:definition "ì¼ìƒì—ì„œ ë°œìƒí•˜ëŠ” ë¶€ë„ë•í•œ í–‰ë™ì˜ ì—¬ëŸ¬ ì›ì¸ì„ ë¶„ì„í•˜ê³ , ë„ë•ì  ì¸ê²©ì´ ê°–ì¶”ì–´ì•¼ í•  íŠ¹ì„±ë“¤ì„ íŒŒì•…í•˜ì—¬ ì´ë¥¼ ë‚´ë©´í™”í•˜ëŠ” ì˜ì§€ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_GoldenSlumber .
edu:ST_9do01-03 a edu:Standard ; dc:identifier "9ë„01-03" ; edu:volume "ë„ë• 1" ; skos:definition "í–‰ë³µì— ê´€í•œ ì‹¬ë¦¬ì , ì‚¬íšŒì , ìœ¤ë¦¬ì  ì ‘ê·¼ ë“±ì„ í†µí•´ í–‰ë³µì˜ ì˜ë¯¸ë¥¼ ì¢…í•©ì ìœ¼ë¡œ íŒŒì•…í•˜ê³ , ì‚¶ì˜ ëª©ì ê³¼ í–‰ë³µì˜ ê´€ê³„ë¥¼ ì •ë¦½í•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Movie_HectorHappiness .
edu:ST_9do01-04 a edu:Standard ; dc:identifier "9ë„01-04" ; edu:volume "ë„ë• 2" ; skos:definition "ì˜³ê³  ê·¸ë¦„ì„ ë¶„ë³„í•  ìˆ˜ ìˆëŠ” ë„ë•ì  ê¸°ì¤€ì„ íƒêµ¬í•˜ê³ , ë„ë•ì  ìƒìƒë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì¼ìƒì˜ ë„ë• ë¬¸ì œë“¤ì— ë„ë•ì  ì¶”ë¡ ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Book_JusticeForYouth .
edu:ST_9do01-05 a edu:Standard ; dc:identifier "9ë„01-05" ; edu:volume "ë„ë• 2" ; skos:definition "ì‚¶ì˜ ìœ í•œí•¨ì— ê´€í•œ ì„±ì°°ì„ í†µí•´ ìƒëª…ì˜ ì†Œì¤‘í•¨ê³¼ ì˜ë¯¸ ìˆëŠ” ì‚¶ì˜ ì¤‘ìš”ì„±ì„ ì¸ì‹í•˜ê³ , ìì‹ ì˜ ë¯¸ë˜ ëª¨ìŠµì„ ìƒìƒí•˜ë©° ì‚¶ì„ ê³„íší•˜ê³  ì´ë¥¼ ì‹¤ì²œí•˜ëŠ” ì˜ì§€ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_TuesdaysWithMorrie .
edu:ST_9do01-06 a edu:Standard ; dc:identifier "9ë„01-06" ; edu:volume "ë„ë• 2" ; skos:definition "ë‚´ë©´ì— ëŒ€í•œ ì„±ì°°ì„ í†µí•´ ì‹¬ë¦¬ì  ê³ í†µê³¼ ë¶ˆì•ˆ, ìš°ìš¸ê° ë“±ì˜ ì›ì¸ì„ ì°¾ê³ , ë§ˆìŒì˜ í‰ì˜¨ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ë°©ì•ˆë“¤ì„ ë‹¤ê°ì ìœ¼ë¡œ ëª¨ìƒ‰í•˜ì—¬ ì‹¤ì²œí•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Book_MindManagement .
edu:ST_9do01-07 a edu:Standard ; dc:identifier "9ë„01-07" ; edu:volume "ë„ë• 2" ; skos:definition "ì‚¶ì—ì„œ ì§ì—…ì´ ê°–ëŠ” ì˜ë¯¸ì™€ ê°€ì¹˜ë¥¼ íŒŒì•…í•˜ë©°, ì‚¬ë¡€ íƒêµ¬ë¥¼ í†µí•´ ì§ì—…ì  ì–‘ì‹¬ê³¼ ì§ì—…ìœ¤ë¦¬ì˜ í•„ìš”ì„±ì„ ì •ë‹¹í™”í•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Movie_Hudsucker .

# [íƒ€ì¸ê³¼ì˜ ê´€ê³„]
edu:ST_9do02-01 a edu:Standard ; dc:identifier "9ë„02-01" ; edu:volume "ë„ë• 1" ; skos:definition "ì •ì„œì , ë°°ë ¤ì  ê³µë™ì²´ë¡œì„œ ê°€ì •ì˜ íŠ¹ì„±ê³¼ ë„ë•ì  ê¸°ëŠ¥ì„ íŒŒì•…í•˜ê³ , ê°€ì •ì—ì„œ ë°œìƒí•˜ëŠ” ê°ˆë“±ì„ ê³µê°ì ì¸ ì†Œí†µê³¼ ë¯¼ì£¼ì ì¸ ê³¼ì •ì„ í†µí•´ í•´ì†Œí•˜ëŠ” ì˜ì§€ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Movie_InsideOut .
edu:ST_9do02-02 a edu:Standard ; dc:identifier "9ë„02-02" ; edu:volume "ë„ë• 1" ; skos:definition "ì¹œêµ¬ì˜ ì˜ë¯¸ì™€ ê°€ì¹˜ë¥¼ ì‚¶ì˜ ë§¥ë½ ì†ì—ì„œ íƒêµ¬í•˜ê³ , ì„œë¡œë¥¼ ì¸ê²©ì ìœ¼ë¡œ ì¡´ì¤‘í•˜ëŠ” ì¹œêµ¬ ê´€ê³„ë¥¼ ìƒìƒí•˜ë©° ì´ë¥¼ ì‹¤í˜„í•˜ëŠ” ì˜ì§€ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_FriendLegend .
edu:ST_9do02-03 a edu:Standard ; dc:identifier "9ë„02-03" ; edu:volume "ë„ë• 1" ; skos:definition "ê°€ìƒê³µê°„ê³¼ í˜„ì‹¤ ì„¸ê³„ì— ëŒ€í•œ ë¹„êµâ‹…ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ê°€ìƒê³µê°„ì—ì„œ ë°œìƒí•˜ëŠ” ë„ë• ë¬¸ì œë“¤ì˜ ì›ì¸ê³¼ í•´ê²° ë°©ì•ˆì„ ì œì•ˆí•˜ê³ , íƒ€ì¸ì„ ì¡´ì¤‘í•˜ë©° ê°€ìƒê³µê°„ì„ í™œìš©í•˜ëŠ” íƒœë„ë¥¼ í•¨ì–‘í•œë‹¤." ; edu:recommendedResource res:Docu_SocialDilemma .
edu:ST_9do02-04 a edu:Standard ; dc:identifier "9ë„02-04" ; edu:volume "ë„ë• 2" ; skos:definition "ì¸ê°„ì„ ê´€ê³„ì  ì¡´ì¬ë¡œ í•´ì„í•  ìˆ˜ ìˆëŠ” ì´ìœ ì— ê·¼ê±°í•˜ì—¬ íƒ€ì¸ê³¼ì˜ ê´€ê³„ì—ì„œ í•„ìš”í•œ ê°€ì¹˜â‹…ë•ëª©ì„ íƒêµ¬í•˜ê³ , íƒ€ì¸ì˜ ìƒê°ê³¼ ê°ì •ì— ê³µê°í•˜ëŠ” íƒœë„ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_Wonder .
edu:ST_9do02-05 a edu:Standard ; dc:identifier "9ë„02-05" ; edu:volume "ë„ë• 2" ; skos:definition "ë‹¤ì–‘í•œ ê°ˆë“± ìƒí™©ì„ í‰í™”ì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ì•ˆì„ ëª¨ìƒ‰í•˜ê³ , í­ë ¥ì˜ ìœ í˜•ê³¼ ì›ì¸, ê²°ê³¼ì— ëŒ€í•œ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ì¼ìƒì˜ í­ë ¥ ìƒí™©ì— ëŒ€í•œ ëŒ€ì²˜ ëŠ¥ë ¥ì„ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_Piggybook .
edu:ST_9do02-06 a edu:Standard ; dc:identifier "9ë„02-06" ; edu:volume "ë„ë• 2" ; skos:definition "ì²­ì†Œë…„ê¸°ì˜ ë°”ëŒì§í•œ ì„±ìœ¤ë¦¬ë¥¼ íƒêµ¬í•˜ì—¬ ë‚´ë©´í™”í•˜ê³ , ì‚¬íšŒâ‹…ë¬¸í™”ì  ì°¨ì›ì—ì„œ ì„±ì˜ ì˜ë¯¸ë¥¼ íŒŒì•…í•˜ì—¬ ì„±ì— ëŒ€í•œ í¸ê²¬ì˜ ë¬¸ì œì ì„ ë¶„ì„í•˜ê³  ì´ë¥¼ ë°”ë¡œì¡ëŠ” ì˜ì§€ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_PaperBagPrincess .

# [ì‚¬íšŒÂ·êµ­ê°€Â·ì§€êµ¬ ê³µë™ì²´]
edu:ST_9do03-01 a edu:Standard ; dc:identifier "9ë„03-01" ; edu:volume "ë„ë• 1" ; skos:definition "ì¸ê¶Œì„ ì¡´ì¤‘í•´ì•¼ í•˜ëŠ” ë„ë•ì  ì´ìœ ë¥¼ ì •ë‹¹í™”í•˜ê³ , ì¸ê¶Œ ì¹¨í•´ ì‚¬ë¡€ì— ëŒ€í•œ íƒêµ¬ë¥¼ í†µí•´ ê·¸ ì›ì¸ê³¼ í•´ê²° ë°©ì•ˆì„ ë„ì¶œí•¨ìœ¼ë¡œì¨ ì¸ê¶Œ ê°ìˆ˜ì„±ì„ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_HumanRights .
edu:ST_9do03-02 a edu:Standard ; dc:identifier "9ë„03-02" ; edu:volume "ë„ë• 1" ; skos:definition "ì™¸ì§‘ë‹¨ì— ëŒ€í•œ í¸ê²¬ì„ ë¹„íŒì ìœ¼ë¡œ ë¶„ì„í•˜ê³ , íƒ€ë¬¸í™”â‹…íƒ€ì¢…êµâ‹…íƒ€ì¸ì¢…ì„ ì¡´ì¤‘í•´ì•¼ í•˜ëŠ” ì´ìœ ì— ê·¼ê±°í•˜ì—¬ ì°¨ì´ì™€ ë‹¤ì–‘ì„±ì— ëŒ€í•œ ì—´ë¦° ë§ˆìŒì„ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_TrueStoryWolf .
edu:ST_9do03-03 a edu:Standard ; dc:identifier "9ë„03-03" ; edu:volume "ë„ë• 1" ; skos:definition "ë¶í•œì— ëŒ€í•œ ì´í•´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¶„ë‹¨ì˜ ë¬¸ì œì ì„ ë¶„ì„í•˜ê³ , ë„ë•ì  ê°€ì¹˜ì— ê¸°ì´ˆí•˜ì—¬ í†µì¼ì˜ ì˜ë¯¸ë¥¼ ì¬êµ¬ì„±í•¨ìœ¼ë¡œì¨ ë°”ëŒì§í•œ ë‚¨ë¶ê´€ê³„ ë° í†µì¼ì˜ ë°©í–¥ì„ ì œì•ˆí•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Movie_AsOne .
edu:ST_9do03-04 a edu:Standard ; dc:identifier "9ë„03-04" ; edu:volume "ë„ë• 2" ; skos:definition "ì •ì˜ë¡œìš´ ì‚¬íšŒë¥¼ ìƒìƒí•´ë³´ê³ , ì´ë¥¼ ì‹¤í˜„í•  ìˆ˜ ìˆëŠ” ì •ì˜ì˜ ì›ì¹™ê³¼ ì œë„ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì˜ê²¬ë“¤ì„ ë¯¼ì£¼ì ì¸ ë°©ì‹ìœ¼ë¡œ ì¢…í•©í•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Book_JusticeForKids .
edu:ST_9do03-05 a edu:Standard ; dc:identifier "9ë„03-05" ; edu:volume "ë„ë• 2" ; skos:definition "êµ­ê°€ì™€ ì‹œë¯¼ ì‚¬ì´ì—ì„œ ë°œìƒí•˜ëŠ” ìœ¤ë¦¬ì  ìŸì ë“¤ì„ íƒêµ¬í•˜ê³ , êµ­ê°€ì™€ ì‹œë¯¼ ì‚¬ì´ì˜ ë°”ëŒì§í•œ ê´€ê³„ì— ê¸°ì´ˆí•˜ì—¬ êµ­ê°€ì™€ ì‹œë¯¼ì˜ ì—­í• ì„ ì¬êµ¬ì„±í•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Movie_TheAttorney .
edu:ST_9do03-06 a edu:Standard ; dc:identifier "9ë„03-06" ; edu:volume "ë„ë• 2" ; skos:definition "ì¸ë¥˜ì˜ ê³ í†µì— ê³µê°í•˜ë©° ì§€êµ¬ì  ì°¨ì›ì˜ ë‹¤ì–‘í•œ ë„ë• ë¬¸ì œë“¤ì„ íƒêµ¬í•˜ê³ , í•´ê²° ë°©ì•ˆì„ ëª¨ìƒ‰í•˜ì—¬ ì‹¤ì²œí•˜ëŠ” ìì„¸ë¥¼ ê°–ëŠ”ë‹¤." ; edu:recommendedResource res:Docu_Anthropocene .
edu:ST_9do03-07 a edu:Standard ; dc:identifier "9ë„03-07" ; edu:volume "ë„ë• 2" ; skos:definition "í˜„ëŒ€ ê³¼í•™ê¸°ìˆ ê³¼ ê´€ë ¨ëœ ìœ¤ë¦¬ì  ìŸì ì˜ ë¶„ì„ì„ í†µí•´ ê³¼í•™ê¸°ìˆ ì˜ ìœ ìš©ì„±ê³¼ í•œê³„ë¥¼ ì¸ì‹í•˜ê³ , ê³¼í•™ê¸°ìˆ ì˜ ë°”ëŒì§í•œ í™œìš©ì— ê´€í•œ ê´€ì‹¬ê³¼ ì±…ì„ ì˜ì‹ì„ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_BraveNewWorld .

# [ìì—°Â·ì´ˆì›”ê³¼ì˜ ê´€ê³„]
edu:ST_9do04-01 a edu:Standard ; dc:identifier "9ë„04-01" ; edu:volume "ë„ë• 1" ; skos:definition "ì¸ê°„ ì´ì™¸ì˜ ìƒëª…ì²´ë¥¼ ë„ë•ì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•˜ëŠ” ì´ìœ ë¥¼ ì •ë‹¹í™”í•˜ê³ , ìƒëª…ì„ ê°€ì§„ ì¡´ì¬ë“¤ì´ ê²ªëŠ” ê³ í†µì— ê³µê°í•˜ë©° ìƒëª…ì„ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ” íƒœë„ë¥¼ ê¸°ë¥¸ë‹¤." ; edu:recommendedResource res:Book_LifeRespect .
edu:ST_9do04-02 a edu:Standard ; dc:identifier "9ë„04-02" ; edu:volume "ë„ë• 2" ; skos:definition "ìì—°ì— ëŒ€í•œ ë™ì–‘ê³¼ ì„œì–‘ì˜ ì£¼ìš” ì…ì¥ë“¤ì„ í† ëŒ€ë¡œ ì¸ê°„ê³¼ ìì—°ì˜ ë°”ëŒì§í•œ ê´€ê³„ë¥¼ ë„ì¶œí•˜ê³ , í™˜ê²½ ìœ„ê¸°ì— ëŒ€í•œ ìœ¤ë¦¬ì  ì±…ì„ì„ êµ¬ì²´í™”í•˜ì—¬ ì‹¤ì²œí•  ìˆ˜ ìˆë‹¤." ; edu:recommendedResource res:Movie_Mononoke .

# --- Resources with Media Tags ---
res:Book_SuperTurtle a edu:LearningResource ; dc:title "ìŠˆí¼ ê±°ë¶" ; edu:mediaTag "ê·¸ë¦¼ì±…" .
res:Book_GoldenSlumber a edu:LearningResource ; dc:title "ê³¨ë“  ìŠ¬ëŸ¼ë²„" ; edu:mediaTag "ì†Œì„¤" .
res:Movie_HectorHappiness a edu:LearningResource ; dc:title "ê¾¸ë»¬ ì”¨ì˜ í–‰ë³µì—¬í–‰" ; edu:mediaTag "ì˜í™”" .
res:Book_JusticeForYouth a edu:LearningResource ; dc:title "ì •ì˜ë€ ë¬´ì—‡ì¸ê°€(ì²­ì†Œë…„)" ; edu:mediaTag "ì¸ë¬¸" .
res:Book_TuesdaysWithMorrie a edu:LearningResource ; dc:title "ëª¨ë¦¬ì™€ í•¨ê»˜í•œ í™”ìš”ì¼" ; edu:mediaTag "ì—ì„¸ì´" .
res:Book_MindManagement a edu:LearningResource ; dc:title "ê¸°ë¶„ì„ ê´€ë¦¬í•˜ë©´ ì¸ìƒì´ ê´€ë¦¬ëœë‹¤" ; edu:mediaTag "ì—ì„¸ì´" .
res:Movie_Hudsucker a edu:LearningResource ; dc:title "í—ˆë“œì„œì»¤ ëŒ€ë¦¬ì¸" ; edu:mediaTag "ì˜í™”" .
res:Movie_InsideOut a edu:LearningResource ; dc:title "ì¸ì‚¬ì´ë“œ ì•„ì›ƒ" ; edu:mediaTag "ì• ë‹ˆë©”ì´ì…˜" .
res:Book_FriendLegend a edu:LearningResource ; dc:title "ì¹œêµ¬ì˜ ì „ì„¤" ; edu:mediaTag "ê·¸ë¦¼ì±…" .
res:Docu_SocialDilemma a edu:LearningResource ; dc:title "ì†Œì…œ ë”œë ˆë§ˆ" ; edu:mediaTag "ë‹¤í" .
res:Book_Wonder a edu:LearningResource ; dc:title "ì›ë”" ; edu:mediaTag "ì†Œì„¤" .
res:Book_Piggybook a edu:LearningResource ; dc:title "ë¼ì§€ì±…" ; edu:mediaTag "ê·¸ë¦¼ì±…" .
res:Book_PaperBagPrincess a edu:LearningResource ; dc:title "ì¢…ì´ ë´‰ì§€ ê³µì£¼" ; edu:mediaTag "ê·¸ë¦¼ì±…" .
res:Book_HumanRights a edu:LearningResource ; dc:title "ë¬´ê¸°ë ¥í•œ ì¸ê¶Œì€ ê°€ë¼" ; edu:mediaTag "ì¸ë¬¸" .
res:Book_TrueStoryWolf a edu:LearningResource ; dc:title "ëŠ‘ëŒ€ê°€ ë“¤ë ¤ì£¼ëŠ” ì•„ê¸° ë¼ì§€ ì‚¼í˜•ì œ" ; edu:mediaTag "ê·¸ë¦¼ì±…" .
res:Movie_AsOne a edu:LearningResource ; dc:title "ì½”ë¦¬ì•„" ; edu:mediaTag "ì˜í™”" .
res:Book_JusticeForKids a edu:LearningResource ; dc:title "ì–´ë¦°ì´ë¥¼ ìœ„í•œ ì •ì˜ë€ ë¬´ì—‡ì¸ê°€" ; edu:mediaTag "ì¸ë¬¸" .
res:Movie_TheAttorney a edu:LearningResource ; dc:title "ë³€í˜¸ì¸" ; edu:mediaTag "ì˜í™”" .
res:Docu_Anthropocene a edu:LearningResource ; dc:title "ì¸ë¥˜ì„¸" ; edu:mediaTag "ë‹¤í" .
res:Book_BraveNewWorld a edu:LearningResource ; dc:title "ë©‹ì§„ ì‹ ì„¸ê³„" ; edu:mediaTag "ì†Œì„¤" .
res:Book_LifeRespect a edu:LearningResource ; dc:title "ì‚´ì•„ìˆëŠ” ëª¨ë“  ê²ƒë“¤ì— ëŒ€í•œ ì˜ˆì˜" ; edu:mediaTag "ì¸ë¬¸" .
res:Movie_Mononoke a edu:LearningResource ; dc:title "ëª¨ë…¸ë…¸ì¼€ íˆë©”" ; edu:mediaTag "ì• ë‹ˆë©”ì´ì…˜" .

# --- High School (Snippet for search only) ---
edu:ST_12hyunyun01-01 a edu:Standard ; dc:identifier "12í˜„ìœ¤01-01" ; edu:volume "ê³ êµ" ; skos:definition "ìœ¤ë¦¬í•™ì˜ ì„±ê²©ê³¼ íŠ¹ì§•ì„ ë°”íƒ•ìœ¼ë¡œ ìœ¤ë¦¬ì  ì¡´ì¬ë¡œì„œì˜ ì¸ê°„ ë³¸ì„±ì„ ì´í•´í•˜ê³ , í˜„ëŒ€ì‚¬íšŒì˜ ë‹¤ì–‘í•œ ìœ¤ë¦¬ ë¬¸ì œë¥¼ íƒêµ¬ ë° í† ë¡ í•  ìˆ˜ ìˆë‹¤." .
edu:ST_12yunsa01-01 a edu:Standard ; dc:identifier "12ìœ¤ì‚¬01-01" ; edu:volume "ê³ êµ" ; skos:definition "ê³µìì‚¬ìƒì— ë°”íƒ•í•˜ì—¬ ë§¹ìì™€ ìˆœì, ì£¼í¬ì™€ ì™•ìˆ˜ì¸ì˜ ì¸ì„±ë¡ ì„ ë¹„êµí•˜ê³ , ì¸ê°„ ë³¸ì„±ì˜ ì…ì¥ì— ë”°ë¥¸ ìœ¤ë¦¬ì  ì‚¶ì˜ ëª©í‘œ ë° ë°©ë²•ë¡ ì˜ ì°¨ì´ì™€ ê·¸ ì˜ì˜ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤." .
edu:ST_12inyun01-01 a edu:Standard ; dc:identifier "12ì¸ìœ¤01-01" ; edu:volume "ê³ êµ" ; skos:definition "ë‚´ ëª¸ê³¼ ë§ˆìŒì˜ ê´€ê³„ë¥¼ íƒêµ¬í•˜ê³ , ì‹¬ì‹ ì˜ í†µí•©ì„±ì„ ìê°í•˜ì—¬ ë„ë•ì  ì£¼ì²´ë¡œì„œ ìì‹ ì„ ì´í•´í•˜ê³  ì¡´ì¤‘í•  ìˆ˜ ìˆë‹¤." .
`;

        const AREA_MAP = {
            '01': { id: 'Area_1', label: 'ìì‹ ', fullName: 'I. ìì‹ ê³¼ì˜ ê´€ê³„', color: '#FF007F', competencies: ['ìê¸°ì„±ì°°Â·ê³„ë°œ ì—­ëŸ‰'] },
            '02': { id: 'Area_2', label: 'íƒ€ì¸', fullName: 'II. íƒ€ì¸ê³¼ì˜ ê´€ê³„', color: '#FFFF00', competencies: ['ë„ë•ì  ëŒ€ì¸ê´€ê³„ ì—­ëŸ‰'] },
            '03': { id: 'Area_3', label: 'ì‚¬íšŒ', fullName: 'III. ì‚¬íšŒê³µë™ì²´ì™€ì˜ ê´€ê³„', color: '#00FFFF', competencies: ['ë„ë•ì  ì‚¬ê³  ì—­ëŸ‰', 'ë„ë•ì  ê³µë™ì²´ ì—­ëŸ‰'] },
            '04': { id: 'Area_4', label: 'ìì—°', fullName: 'IV. ìì—°ê³¼ì˜ ê´€ê³„', color: '#BF00FF', competencies: ['ë„ë•ì  ì‚¬ê³  ì—­ëŸ‰', 'ìê¸°ì„±ì°°Â·ê³„ë°œ ì—­ëŸ…'] }
        };

        // ê°€ë„¤ì˜ 9ë‹¨ê³„ ìˆ˜ì—… ì‚¬íƒœ (class_strategy.ttl ê¸°ë°˜)
        const GAGNE_EVENTS = [
            { id: 'Event01', step: 1, label: 'ì£¼ì˜ ì§‘ì¤‘', strategies: ['í¥ë¯¸ ìœ ë°œí•˜ê¸°', 'ì‹œë²”', 'ë‚®ì€ ë‹¨ê³„ì˜ ê±°ë¦¬ë‘ê¸°'] },
            { id: 'Event02', step: 2, label: 'ìˆ˜ì—… ëª©í‘œ ì œì‹œ', strategies: ['í•™ìŠµëª©í‘œ ìœ ì§€ì‹œí‚¤ê¸°', 'ëª©í‘œì¶”êµ¬ ìœ ì§€í•˜ê¸°', 'í•™ìŠµìì˜ ìš”êµ¬ë¥¼ ë¶ë‹ìš°ê³  ì„¸ë¶„í™”ëœ ëª©í‘œ ì„¤ì •í•˜ê¸°', 'ì„¤ëª… ì œê³µí•˜ê¸°'] },
            { id: 'Event03', step: 3, label: 'ì„ í–‰ í•™ìŠµ ìƒê¸°', strategies: ['ììœ ì˜ ì •ë„ ê°ì†Œì‹œí‚¤ê¸°', 'ê³„íší•˜ê¸°', 'í™œì„±í™”ì™€ ë°°ê²½ ì§€ì‹ì˜ í™œìš©', 'êµ¬ì²´í™”í•˜ê¸°'], readingProcess: 'ë…ì„œ ì „' },
            { id: 'Event04', step: 4, label: 'ìê·¹ ìë£Œ ì œì‹œ', strategies: ['ê¸°ëŒ€í–‰ë™ ì‹œë²”ë³´ì´ê¸°', 'ì¤‘ê°„ë‹¨ê³„ì˜ ê±°ë¦¬ë‘ê¸°', 'í•„ìš”ì— ë”°ë¼ ì„¤ëª… ì œê³µí•˜ê¸°', 'ëª¨ë¸ë§', 'í•™ìŠµìì˜ ë°œì–¸ê³¼ ì§ˆë¬¸ì„ ê³ ë¬´í•˜ê³  ì´ìš©í•˜ê¸°'] },
            { id: 'Event05', step: 5, label: 'í•™ìŠµ ì•ˆë‚´', strategies: ['ê³¼ì „ í†µì œ', 'ì£¼ì œì˜ ì´ˆì ', 'í•™ìŠµìì˜ ì‹¤ìŠµ ì§€ë„í•˜ê³  ì¡°ë ¥í•˜ê¸°', 'ì§ì ‘ì ì¸ ê°€ë¥´ì¹¨', 'ì‚¬ê³ ê³¼ì • ì‹œë²” ë³´ì´ê¸°', 'ì„¤ì •ëœ ì¡°ë ¥ ì œê³µí•˜ê¸°', 'êµìˆ˜í•˜ê¸°', 'ì¸ì§€ì  êµ¬ì¡°í™”'], readingProcess: 'ë…ì„œ ì¤‘' },
            { id: 'Event06', step: 6, label: 'ì„±ì·¨ ìˆ˜í–‰ ìœ ë„', strategies: ['ë³´ë‹¤ ë³µì¡í•œ ì–¸ì–´ì™€ í‘œí˜„ì˜ í™•ëŒ€', 'í•™ìŠµì ì°¸ì—¬ ê¶Œìœ í•˜ê¸°', 'ì§„ìˆ ì´ë‚˜ ì…ì¥ í‘œëª…ì— ëŒ€í•œ ê·¼ê±°ì˜ ì¦ê°€', 'í•™ìƒì˜ ê¸°ì—¬ì— ëŒ€í•œ ë°˜ì‘', 'í•™ìŠµìê°€ ë‹¨ì„œë¥¼ ì œê³µí•˜ë„ë¡ ìœ ë„í•˜ê¸°', 'ìê¸° ì„ íƒì  ìˆœì„œê°€ í¬í•¨ëœ ì¼ë°˜ì  ì°¸ì—¬', 'í•™ìƒì˜ ì¸ì§€ì  ì •ì˜ì  ìƒíƒœ ë° ëŠ¥ë ¥ ìˆ˜ì¤€ ì•Œê³ ì ë…¸ë ¥í•˜ê¸°'], readingProcess: 'ë…ì„œ ì¤‘' },
            { id: 'Event07', step: 7, label: 'í”¼ë“œë°± ì œê³µ', strategies: ['ê³¼ì œì˜ ì£¼ìš” íŠ¹ì„± í‘œì‹œí•˜ê¸°', 'í”¼ë“œë°± ì£¼ê¸°', 'í•™ìŠµì ì´í•´ í™•ì¸ ë° ëª…ë£Œí™”í•˜ê¸°', 'ìœ ê´€ ì¡°ì ˆ', 'í•™ìŠµìì˜ ì‚¬ê³ ë¥¼ ì§ì ‘ì ìœ¼ë¡œ í‰ê°€í•˜ì§€ ì•ŠëŠ” í”¼ë“œë°± ì œê³µí•˜ê¸°', 'ì •ì„œì ì¸ ì§€ì§€ì™€ ì–‘ì„±ì˜ ë†’ì€ ìˆ˜ì¤€ ë³´ì—¬ì£¼ê¸°', 'í•™ìŠµìì˜ ì‹¤ìˆ˜ì— ìœ ë™ì ìœ¼ë¡œ ë°˜ì‘'] },
            { id: 'Event08', step: 8, label: 'ìˆ˜í–‰ í‰ê°€', strategies: ['ì˜ìš•ì ì´ë©´ì„œë„ ìœ„í˜‘ì ì´ì§€ ì•Šì€ í™˜ê²½ ì œê³µí•˜ê¸°', 'í•™ìŠµìê°€ ë‹µì„ ìœ ì¶œí•˜ê¸° ìœ„í•´ì„œ í˜‘ì˜í•˜ëŠ” ë™ì•ˆ ì¸ë‚´í•˜ê¸°', 'ì§ˆë¬¸í•˜ê¸°', 'ë†’ì€ ë‹¨ê³„ì˜ ê±°ë¦¬ë‘ê¸°'], readingProcess: 'ë…ì„œ í›„' },
            { id: 'Event09', step: 9, label: 'íŒŒì§€ ë° ì „ì´ ì œê³ ', strategies: ['ì•Œë ¤ì§„ ë‹µì´ ê±°ì˜ ì—†ëŠ” ì§ˆë¬¸', 'ì—°ê²°ëœ ë‹´í™” í† ë¡ ', 'êµì‚¬ì˜ ì§€ì§€ ê°•ë„ ì¤„ì´ê¸°', 'ì“°ê¸°', 'ìƒí˜¸ì‘ìš©ì— ìˆì–´ ëŒ€í™”ì  ìœ í˜• ì‚¬ìš©í•˜ê¸°'], readingProcess: 'ë…ì„œ í›„' }
        ];

        // ë…ì„œ ì „ëµ (reading_strategy.ttl ê¸°ë°˜)
        const READING_STRATEGIES = {
            'ë…ì„œ ì „': ['ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°', 'ë¸Œë ˆì¸ìŠ¤í† ë°', 'SQ3R', 'KWL', 'í›‘ì–´ ì½ê¸°'],
            'ë…ì„œ ì¤‘': ['SQ3R', 'ë§ˆì¸ë“œë§µ', 'ìºë¦­í„° ì°¨íŠ¸', 'ì•™ì¼€ì´íŠ¸/ì§ˆë¬¸í‘œ', 'KWL', 'QAR', 'ì´ì•¼ê¸°ì§€ë„', 'ìƒê° ë§í•˜ê¸°', 'ê±´ë„ˆë›°ë©° ì½ê¸°'],
            'ë…ì„œ í›„': ['ë§ˆì¸ë“œë§µ', 'ìš”ì•½ê¸°ë²•', 'ê·¸ë˜í”½ì¡°ì§ì', 'QAR', 'ì´ì•¼ê¸°ì§€ë„']
        };

        // í…ìŠ¤íŠ¸ ì¢…ë¥˜ë³„ ì¶”ì²œ ì „ëµ (ì‚¬ìš©ì ìš”ì²­ ê¸°ë°˜)
        const TEXT_TYPE_STRATEGIES = {
            'ì£¼ì¥': ['ì•™ì¼€ì´íŠ¸/ì§ˆë¬¸í‘œ', 'QAR', 'ìƒê° ë§í•˜ê¸°'],
            'ì‚¬ì‹¤': ['KWL', 'ìš”ì•½ê¸°ë²•', 'ê·¸ë˜í”½ì¡°ì§ì', 'SQ3R'],
            'ê°ìƒ': ['ìºë¦­í„° ì°¨íŠ¸', 'ì´ì•¼ê¸°ì§€ë„', 'ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°']
        };

        const TEXT_TYPE_KEYWORDS = {
            'ì£¼ì¥': ['ë¶„ì„', 'ë¹„íŒ', 'íƒ€ë‹¹ì„±', 'ìŸì '],
            'ì‚¬ì‹¤': ['ì´í•´', 'ì˜ë¯¸', 'íŠ¹ì§•', 'ì›ì¸'],
            'ê°ìƒ': ['ê°ìƒ', 'ì„±ì°°', 'íƒœë„', 'ë‚´ë©´í™”']
        };

        const ACTIVITY_TEMPLATES = {
            'ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°': 'ê¸€ì˜ ì œëª©ê³¼ ì‹œê° ìë£Œë¥¼ ë³´ë©° ì–´ë–¤ ì´ì•¼ê¸°ê°€ ì „ê°œë ì§€ ë„ì‹í™”í•˜ì—¬ ì˜ˆì¸¡í•´ ë´…ì‹œë‹¤.',
            'ë¸Œë ˆì¸ìŠ¤í† ë°': 'ì£¼ì œì™€ ê´€ë ¨í•˜ì—¬ ë– ì˜¤ë¥´ëŠ” ëª¨ë“  ë‹¨ì–´ì™€ ì•„ì´ë””ì–´ë¥¼ ììœ ë¡­ê²Œ ê³µìœ í•´ ë´…ì‹œë‹¤.',
            'SQ3R': 'í›‘ì–´ë³´ê¸°(Survey), ì§ˆë¬¸í•˜ê¸°(Question), ì½ê¸°(Read), ì•”ì†¡í•˜ê¸°(Recite), ê²€í† í•˜ê¸°(Review) ë‹¨ê³„ë¥¼ ë”°ë¼ ê¹Šì´ ìˆê²Œ ì½ì–´ ë´…ì‹œë‹¤.',
            'ë§ˆì¸ë“œë§µ': 'ì¤‘ì‹¬ ê°œë…ì„ ë°”íƒ•ìœ¼ë¡œ ê°€ì§€ë¥¼ ë»—ì–´ ë‚˜ê°€ë©° ì‚¬ê³ ì˜ ì§€ë„ë¥¼ ê·¸ë ¤ ë´…ì‹œë‹¤.',
            'ìºë¦­í„° ì°¨íŠ¸': 'ë“±ì¥ì¸ë¬¼ì˜ ì„±ê²©, í–‰ë™, ë™ê¸°ë¥¼ ë¶„ì„í•˜ì—¬ ì¸ë¬¼ íŠ¹ì§• ì§€ë„ë¥¼ ì™„ì„±í•´ ë´…ì‹œë‹¤.',
            'ì•™ì¼€ì´íŠ¸/ì§ˆë¬¸í‘œ': 'ê¸€ì˜ ìŸì ì— ëŒ€í•´ ìì‹ ì˜ ì…ì¥ì„ ì •í•˜ê³  ì§ˆë¬¸í‘œë¥¼ ì‘ì„±í•´ ë´…ì‹œë‹¤.',
            'KWL': 'ì•Œê³  ìˆëŠ” ê²ƒ(Know), ì•Œê³  ì‹¶ì€ ê²ƒ(Want), ë°°ìš´ ê²ƒ(Learn)ì„ ì°¨ë¡€ë¡œ ì •ë¦¬í•´ ë´…ì‹œë‹¤.',
            'ìš”ì•½ê¸°ë²•': 'ê¸€ì˜ í•µì‹¬ ë¬¸ì¥ì„ ì¶”ë ¤ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ìš”ì•½í•´ ë´…ì‹œë‹¤.',
            'ê·¸ë˜í”½ì¡°ì§ì': 'í‘œë‚˜ ë‹¤ì´ì–´ê·¸ë¨ ë“± ì‹œê°ì ì¸ í‹€ì„ í™œìš©í•˜ì—¬ ê¸€ì˜ êµ¬ì¡°ë¥¼ ì²´ê³„í™”í•´ ë´…ì‹œë‹¤.',
            'QAR': 'ì§ˆë¬¸ê³¼ ë‹µë³€ì˜ ê´€ê³„(Question-Answer Relationship)ë¥¼ ë¶„ì„í•˜ë©° ì •ë‹µì˜ ìœ„ì¹˜ë¥¼ ì°¾ì•„ë´…ì‹œë‹¤.',
            'ì´ì•¼ê¸°ì§€ë„': 'ì‚¬ê±´ì˜ íë¦„ê³¼ ë°°ê²½, í•´ê²° ê³¼ì •ì„ ì‹œê°„ ìˆœì„œëŒ€ë¡œ ì¬êµ¬ì„±í•´ ë´…ì‹œë‹¤.',
            'ìƒê° ë§í•˜ê¸°': 'ê¸€ì„ ì½ìœ¼ë©° ë¨¸ë¦¿ì†ì— ë– ì˜¤ë¥´ëŠ” ìƒê°ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë§í•˜ë©° ì¸ì§€ ê³¼ì •ì„ ê³µìœ í•´ ë´…ì‹œë‹¤.',
            'í›‘ì–´ ì½ê¸°': 'í•µì‹¬ì–´ì™€ ì œëª© ìœ„ì£¼ë¡œ ë¹ ë¥´ê²Œ í›‘ìœ¼ë©° ì „ì²´ì ì¸ ë¶„ìœ„ê¸°ë¥¼ íŒŒì•…í•´ ë´…ì‹œë‹¤.',
            'ê±´ë„ˆë›°ë©° ì½ê¸°': 'í•„ìš”í•œ ì •ë³´ë¥¼ ì°¾ê¸° ìœ„í•´ ì¤‘ìš”í•˜ì§€ ì•Šì€ ë¶€ë¶„ì€ ë¹ ë¥´ê²Œ ë„˜ê¸°ë©° ì½ì–´ ë´…ì‹œë‹¤.'
        };

        function generateDetailedActivity(event, strategy, definition) {
            const template = ACTIVITY_TEMPLATES[strategy] || 'í•´ë‹¹ ì „ëµì„ í™œìš©í•˜ì—¬ í™œë™ì„ ì§„í–‰í•©ë‹ˆë‹¤.';

            switch (event.step) {
                case 1: // ì£¼ì˜ ì§‘ì¤‘
                    return `<strong>[ë„ì…: ì£¼ì˜ ì§‘ì¤‘]</strong><br>êµì‚¬: "ì˜¤ëŠ˜ ë°°ìš¸ '${definition.split(' ')[0]}...'ê³¼ ê´€ë ¨ëœ í¥ë¯¸ë¡œìš´ ìë£Œë¥¼ ë³´ì—¬ì¤„ê²Œìš”. ${strategy} ì „ëµì„ í™œìš©í•´ ì–´ë–¤ ë‚´ìš©ì¼ì§€ ìƒìƒí•´ ë³¼ê¹Œìš”?"`;
                case 3: // ì„ í–‰ í•™ìŠµ ìƒê¸°
                    return `<strong>[ì „ê°œ: ì„ í–‰ í•™ìŠµ ìƒê¸°]</strong><br>í•™ìƒ: ì§€ë‚œ ì‹œê°„ì— ë°°ìš´ í•µì‹¬ ê°œë…ì„ ë– ì˜¬ë¦¬ë©°, ${strategy}ë¥¼ í†µí•´ ì˜¤ëŠ˜ ê³µë¶€í•  ë‚´ìš©ê³¼ ì—°ê²° ì§€ì–´ ë´…ì‹œë‹¤.`;
                case 5: // í•™ìŠµ ì•ˆë‚´
                    return `<strong>[ì „ê°œ: í•™ìŠµ ì•ˆë‚´]</strong><br>êµì‚¬: "ê¸€ì„ ì½ëŠ” ë™ì•ˆ ${strategy}ë¥¼ í™œìš©í•´ ë³´ì„¸ìš”. íŠ¹íˆ ì¸ê³¼ ê´€ê³„ë‚˜ ì¤‘ìš”í•œ íŠ¹ì§•ì„ ë†“ì¹˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤."`;
                case 6: // ì„±ì·¨ ìˆ˜í–‰ ìœ ë„
                    return `<strong>[ì „ê°œ: ì„±ì·¨ ìˆ˜í–‰ ìœ ë„]</strong><br>í•™ìƒ: ì œì‹œëœ í™œë™ì§€ì˜ ${strategy} ì–‘ì‹ì— ë”°ë¼ ìì‹ ì˜ ìƒê°ì„ ì •ë¦¬í•˜ê³  ì¹œêµ¬ë“¤ê³¼ ì˜ê²¬ì„ ë‚˜ëˆ„ì–´ ë´…ì‹œë‹¤.`;
                case 9: // íŒŒì§€ ë° ì „ì´ ì œê³ 
                    return `<strong>[ì •ë¦¬: ì „ì´ ì œê³ ]</strong><br>êµì‚¬: "ì˜¤ëŠ˜ ë°°ìš´ '${strategy}' ë°©ë²•ì„ ë‹¤ë¥¸ ê¸€ì„ ì½ì„ ë•Œë„ ì ìš©í•´ ë³¸ë‹¤ë©´ ì–´ë–¨ê¹Œìš”? ì‚¶ì˜ ë¬¸ì œì— ì–´ë–»ê²Œ ì ìš©í• ì§€ ${strategy}ë¡œ ìµœì¢… ì •ë¦¬í•´ ë´…ì‹œë‹¤."`;
                default:
                    return template;
            }
        }

        function recommendReadingStrategies(definition, process) {
            if (!process) return [];

            // 1. í…ìŠ¤íŠ¸ ì¢…ë¥˜ íŒë³„
            let type = 'ì‚¬ì‹¤'; // ê¸°ë³¸ê°’
            for (const [t, keywords] of Object.entries(TEXT_TYPE_KEYWORDS)) {
                if (keywords.some(k => definition.includes(k))) {
                    type = t;
                    break;
                }
            }

            // 2. í•´ë‹¹ ê³¼ì •ì˜ ì „ì²´ í’€
            const pool = READING_STRATEGIES[process] || [];
            // 3. í•´ë‹¹ í…ìŠ¤íŠ¸ ì¢…ë¥˜ì˜ í•µì‹¬ ì „ëµ
            const core = TEXT_TYPE_STRATEGIES[type] || [];

            // 4. êµì§‘í•© ë° ìˆœìœ„í™” (í…ìŠ¤íŠ¸ ì¢…ë¥˜ë³„ í•µì‹¬ ì „ëµ ìš°ì„ )
            const recommended = [
                ...core.filter(s => pool.includes(s)),
                ...pool.filter(s => !core.includes(s))
            ];

            return recommended.slice(0, 4); // ìƒìœ„ 4ê°œ ë°˜í™˜
        }

        function getBestStrategyInfo(definition, process) {
            // ì„±ì·¨ê¸°ì¤€ í‚¤ì›Œ ë¶„ì„ì„ í†µí•œ ì§€ëŠ¥ì  ì¶”ì²œ ë¡œì§
            const def = definition || '';

            if (process === 'ë…ì„œ ì¤‘') {
                if (def.includes('ì¸ë¬¼') || def.includes('ì„±ì°°') || def.includes('ìì•„') || def.includes('ì¸ê²©') || def.includes('ê°€ì¹˜ê´€')) {
                    return {
                        strategy: 'ìºë¦­í„° ì°¨íŠ¸',
                        reason: 'ë„ë•ì  ì¸ë¬¼ì˜ ë‚´ë©´ ì„±ì°°ê³¼ ì‚¶ì˜ íƒœë„ë¥¼ ê¹Šì´ ìˆê²Œ íƒêµ¬í•˜ê¸°ì— ìºë¦­í„° ì°¨íŠ¸ê°€ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤.',
                        goal: 'ê³µê° ëŠ¥ë ¥ í–¥ìƒ ë° ë„ë•ì  ì¶”ë¡  ëŠ¥ë ¥ í•¨ì–‘'
                    };
                }
                if (def.includes('ê°ˆë“±') || def.includes('í•´ê²°') || def.includes('ì›ì¸') || def.includes('ë¶„ì„') || def.includes('í­ë ¥')) {
                    return {
                        strategy: 'ì›ì¸ê³¼ ê²°ê³¼',
                        reason: 'ê°ˆë“± ìƒí™©ì˜ ê·¼ë³¸ ì›ì¸ì„ ë¶„ì„í•˜ê³  í‰í™”ì  í•´ê²° ë°©ì•ˆì„ ë„ì¶œí•˜ëŠ” ë° ìµœì í™”ëœ ì „ëµì…ë‹ˆë‹¤.',
                        goal: 'ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ ë° ë…¼ë¦¬ì  ì‚¬ê³ ë ¥ ê°•í™”'
                    };
                }
                if (def.includes('ì§ˆë¬¸') || def.includes('íƒêµ¬') || def.includes('ì¶”ë¡ ') || def.includes('íŒë‹¨')) {
                    return {
                        strategy: 'QAR',
                        reason: 'ì§ˆë¬¸ì˜ ìœ í˜•ì„ êµ¬ë¶„í•˜ì—¬ í…ìŠ¤íŠ¸ë¥¼ ê¹Šì´ ìˆê²Œ ì¶”ë¡ í•˜ê³  ë¹„íŒì ìœ¼ë¡œ ì‚¬ê³ í•˜ëŠ” í˜ì„ ê¸¸ëŸ¬ì¤ë‹ˆë‹¤.',
                        goal: 'ë¹„íŒì  ì‚¬ê³ ë ¥ ë° ë…í•´ ì „ëµ ë‚´ë©´í™”'
                    };
                }
                if (def.includes('ë¹„êµ') || def.includes('ëŒ€ì¡°') || def.includes('ì°¨ì´') || def.includes('ë‹¤ì–‘ì„±') || def.includes('ì¡´ì¤‘')) {
                    return {
                        strategy: 'ë¹„êµì™€ ëŒ€ì¡°',
                        reason: 'ì„œë¡œ ë‹¤ë¥¸ ê°€ì¹˜ë‚˜ ë¬¸í™”ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë¹„êµí•˜ì—¬ ê³µí†µì ê³¼ ì°¨ì´ì ì„ ëª…í™•íˆ ì´í•´í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤.',
                        goal: 'ë‹¤ì–‘ì„± ì¡´ì¤‘ íƒœë„ ë° ì¢…í•©ì  ì‚¬ê³  ëŠ¥ë ¥'
                    };
                }
            } else if (process === 'ë…ì„œ í›„') {
                if (def.includes('ìš”ì•½') || def.includes('ì£¼ì œ') || def.includes('ì˜ë¯¸') || def.includes('ì •ë¦½')) {
                    return {
                        strategy: 'ìš”ì•½í•˜ê¸°',
                        reason: 'ì„±ì·¨ê¸°ì¤€ì—ì„œ ê°•ì¡°í•˜ëŠ” í•µì‹¬ ê°€ì¹˜ë¥¼ ìì‹ ì˜ ì–¸ì–´ë¡œ ì •ë¦¬í•˜ì—¬ ì‚¶ì˜ ëª©ì ì„±ì„ í™•ë¦½í•˜ëŠ” ë° í° ë„ì›€ì´ ë©ë‹ˆë‹¤.',
                        goal: 'ì¢…í•©ì  ë¬¸í•´ë ¥ ë° ê°€ì¹˜ ì •ë¦½ ëŠ¥ë ¥'
                    };
                }
            } else if (process === 'ë…ì„œ ì „') {
                if (def.includes('ì„±ì°°') || def.includes('ê²½í—˜') || def.includes('ì´ë¯¸')) {
                    return {
                        strategy: 'KWL',
                        reason: 'ìì‹ ì´ ì´ë¯¸ ì•Œê³  ìˆëŠ” ê²ƒê³¼ ì•Œê³  ì‹¶ì€ ê²ƒì„ êµ¬ë¶„í•˜ì—¬ ëŠ¥ë™ì ì¸ ì½ê¸° ëª©ì ì„ ì„¤ì •í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.',
                        goal: 'ìê¸°ì£¼ë„ì  í•™ìŠµ ëŠ¥ë ¥ ë° ë°°ê²½ì§€ì‹ í™œì„±í™”'
                    };
                }
            }

            return null; // ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì‹œìŠ¤í…œ ì¶”ì²œ ì—†ìŒ
        }

        // ë„ë•ê³¼ í•µì‹¬ ì—­ëŸ‰ ì „ì²´ ëª©ë¡
        const ALL_COMPETENCIES = ['ìê¸°ì„±ì°°Â·ê³„ë°œ ì—­ëŸ‰', 'ë„ë•ì  ëŒ€ì¸ê´€ê³„ ì—­ëŸ‰', 'ë„ë•ì  ì‚¬ê³  ì—­ëŸ‰', 'ë„ë•ì  ê³µë™ì²´ ì—­ëŸ‰'];

        // í‰ê°€ ê³„íš/ìœ í˜• ì „ì²´ ëª©ë¡
        const ALL_ASSESSMENT_TYPES = ['ì„œìˆ Â·ë…¼ìˆ í‰ê°€', 'í¬íŠ¸í´ë¦¬ì˜¤', 'ë°œí‘œ', 'êµ¬ìˆ ', 'ìê¸° í‰ê°€', 'ê´€ì°°í‰ê°€', 'í† ì˜í† ë¡ '];

        // êµìˆ˜Â·í•™ìŠµ ë°©ë²• ë° í‰ê°€ ìœ í˜• ìë™ ë§¤í•‘ í•¨ìˆ˜
        function suggestMethods(definition) {
            const methods = [];
            const assessments = [];
            let task = '';
            let rubric = '';

            // A. ë¶„ì„/ë¹„íŒ/í‰ê°€ â†’ ë¹„íŒì  ë…¼ìˆ 
            if (/ë¶„ì„|ë¹„íŒ|í‰ê°€|íƒêµ¬|ë¹„êµ/.test(definition)) {
                methods.push('í† ë¡ Â·í† ì˜');
                assessments.push('ì„œìˆ Â·ë…¼ìˆ í‰ê°€');
                assessments.push('í† ì˜í† ë¡ ');
                assessments.push('êµ¬ìˆ ');
                task = 'ë„ë•ì  ìŸì  ë¹„íŒì  ë…¼ìˆ  ì“°ê¸°';
                rubric = '[ìƒ] ì£¼ì œë¥¼ ë¹„íŒì  ê´€ì ì—ì„œ ë…¼ë¦¬ì  ê·¼ê±°ë¡œ ëª…í™•íˆ ì„œìˆ í•¨\n[ì¤‘] ë¹„íŒì  ì˜ê²¬ì€ ìˆìœ¼ë‚˜ ë…¼ë¦¬ì  ê·¼ê±°ê°€ ë‹¤ì†Œ ë¶€ì¡±í•¨\n[í•˜] ì£¼ì œ íŒŒì•…ì´ ë¯¸í¡í•˜ê±°ë‚˜ ë¹„íŒì  ì„œìˆ ì´ ë¶€ì¡±í•¨';
            }
            // B. ì‹¤ì²œ/ë‚´ë©´í™”/ìŠµë“ â†’ ì‹¤ì²œ ê¸°ë¡ì¥
            else if (/ì‹¤ì²œ|ë‚´ë©´í™”|ìŠµë“|í•¨ì–‘|ê¸°ë¥¸ë‹¤|í˜•ì„±/.test(definition)) {
                methods.push('ì²´í—˜í•™ìŠµ');
                methods.push('í”„ë¡œì íŠ¸í•™ìŠµ');
                assessments.push('í¬íŠ¸í´ë¦¬ì˜¤');
                assessments.push('ê´€ì°°í‰ê°€');
                assessments.push('ìê¸° í‰ê°€');
                task = 'ìƒí™œ ë°€ì°©í˜• ë„ë• ì‹¤ì²œ ê¸°ë¡ì¥';
                rubric = '[ìƒ] ê°€ì¹˜ë¥¼ ë‚´ë©´í™”í•˜ì—¬ ì§€ì†ì ìœ¼ë¡œ ì‹¤ì²œí•˜ê³  ì„±ì‹¤íˆ ê¸°ë¡í•¨\n[ì¤‘] ì‹¤ì²œí•˜ë ¤ ë…¸ë ¥í•˜ë‚˜ ì§€ì†ì„±ì´ë‚˜ ê¸°ë¡ì´ ë‹¤ì†Œ ë¶€ì¡±í•¨\n[í•˜] ì‹¤ì²œ ì˜ì§€ê°€ ë¶€ì¡±í•˜ê³  ê¸°ë¡ ë‚´ìš©ì´ ë¶€ì‹¤í•¨';
            }
            // C. ì´í•´/ì„¤ëª…/íŠ¹ì§• â†’ ê°œë… ì¹´ë“œë‰´ìŠ¤
            else if (/ì´í•´|ì„¤ëª…|íŠ¹ì§•|íŒŒì•…|ì¸ì‹/.test(definition)) {
                methods.push('ê°•ì˜ì‹');
                assessments.push('ì„œìˆ Â·ë…¼ìˆ í‰ê°€');
                task = 'í•µì‹¬ ê°œë… ì¸í¬ê·¸ë˜í”½(ì¹´ë“œë‰´ìŠ¤) ì œì‘';
                rubric = '[ìƒ] í•µì‹¬ ê°œë…ì„ ì •í™•íˆ ì´í•´í•˜ê³  ì°½ì˜ì ìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ ì„¤ëª…í•¨\n[ì¤‘] ê°œë…ì€ ì´í•´í•˜ê³  ìˆìœ¼ë‚˜ ì„¤ëª… ë°©ì‹ì´ ë‹¤ì†Œ í‰ì´í•¨\n[í•˜] ê°œë… ì´í•´ê°€ ë¶€ì¡±í•˜ê±°ë‚˜ ì„¤ëª… ë‚´ìš©ì´ ë¯¸í¡í•¨';
            }
            // D. ìƒìƒ/ì œì•ˆ/ë„ì¶œ â†’ í•´ê²°ë°©ì•ˆ ì œì•ˆì„œ
            else if (/ìƒìƒ|ì œì•ˆ|ë„ì¶œ|ëª¨ìƒ‰|êµ¬ì„±/.test(definition)) {
                methods.push('í”„ë¡œì íŠ¸í•™ìŠµ');
                assessments.push('ë°œí‘œ');
                assessments.push('êµ¬ìˆ ');
                task = 'ë„ë•ì  ë¬¸ì œ í•´ê²° ë°©ì•ˆ ì œì•ˆì„œ ì‘ì„±';
                rubric = '[ìƒ] ë¬¸ì œ ìƒí™©ì„ ë‹¤ê°ë„ë¡œ ë¶„ì„í•˜ê³  ì‹¤í˜„ ê°€ëŠ¥í•œ ëŒ€ì•ˆì„ ì œì•ˆí•¨\n[ì¤‘] í•´ê²° ë°©ì•ˆì„ ì œì‹œí–ˆìœ¼ë‚˜ ì‹¤í˜„ ê°€ëŠ¥ì„±ì´ ë‹¤ì†Œ ë‚®ìŒ\n[í•˜] ë¬¸ì œ ìƒí™©ì„ ì œëŒ€ë¡œ íŒŒì•…í•˜ì§€ ëª»í•˜ê±°ë‚˜ ì œì•ˆì´ ë¯¸í¡í•¨';
            }
            else {
                task = 'ìˆ˜í–‰ ê³¼ì œëª…ì„ ì…ë ¥í•˜ì„¸ìš”';
                rubric = '[ìƒ] \n[ì¤‘] \n[í•˜] ';
            }

            return {
                methods: [...new Set(methods)],
                assessments: [...new Set(assessments)],
                task,
                rubric
            };
        }

        let allStandards = [];
        let resourcesMap = {};
        let currentFilter = 'All';
        let basket = new Set(); // Stores Standard IDs

        // í™œë™ì§€ ë°ì´í„°ë¥¼ ì„ì‹œ ì €ì¥í•  ê³µê°„ (ì„±ì·¨ê¸°ì¤€ID_ì „ëµì´ë¦„ : ë°ì´í„°)
        let activityDataStore = {};

        function initData() {
            // A. Resources with Tags
            const lines = ttlData.split('\n');
            lines.forEach(line => {
                const match = line.match(/^res:([^ ]+) .*?dc:title "([^"]+)"/);
                if (match) {
                    const id = 'res:' + match[1];
                    const title = match[2];
                    let tag = '';
                    const tagMatch = line.match(/edu:mediaTag "([^"]+)"/);
                    if (tagMatch) tag = tagMatch[1];
                    resourcesMap[id] = { title, tag };
                }
            });

            // B. Standards
            const stdLines = ttlData.split('\n');
            let currentStd = null;

            stdLines.forEach(line => {
                line = line.trim();
                if (!line || line.startsWith('#') || line.startsWith('@prefix')) return;

                if (line.match(/^edu:ST_/)) {
                    if (currentStd) allStandards.push(currentStd);
                    currentStd = {
                        id: line.split(' ')[0],
                        code: '', volume: 'ê³ êµ', definition: '', resource: '',
                        areaId: null
                    };
                }

                if (currentStd) {
                    if (line.includes('dc:identifier')) currentStd.code = line.match(/dc:identifier "([^"]+)"/)[1];
                    if (line.includes('edu:volume')) currentStd.volume = line.match(/edu:volume "([^"]+)"/)[1];
                    if (line.includes('skos:definition')) currentStd.definition = line.match(/skos:definition "([^"]+)"/)[1];
                    if (line.includes('edu:recommendedResource')) currentStd.resource = line.match(/edu:recommendedResource (res:[^ ;.]+)/)[1];

                    if (line.endsWith('.')) {
                        if (currentStd.code.startsWith('9ë„01')) currentStd.areaId = '01';
                        else if (currentStd.code.startsWith('9ë„02')) currentStd.areaId = '02';
                        else if (currentStd.code.startsWith('9ë„03')) currentStd.areaId = '03';
                        else if (currentStd.code.startsWith('9ë„04')) currentStd.areaId = '04';

                        allStandards.push(currentStd);
                        currentStd = null;
                    }
                }
            });

            initGraph();
            renderList();
        }

        // --- GRAPH LOGIC ---
        function initGraph() {
            const container = document.getElementById('graph-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            // Nodes (Root > Area > Volume > Standard)
            // Nodes (Root > Area > Volume > Standard)
            // Clean Radial Hierarchy: Root=40, Area=25, Volume=15, Standard=5
            let nodes = [{ id: 'Root', label: 'ë„ë•', group: 'root', r: 40, color: '#ffffff', fx: width / 2, fy: height / 2 }];
            let links = [];

            Object.keys(AREA_MAP).forEach(k => {
                const area = AREA_MAP[k];
                nodes.push({ id: area.id, label: area.label, group: 'area', r: 25, color: area.color });
                links.push({ source: 'Root', target: area.id });

                ['ë„ë• 1', 'ë„ë• 2'].forEach(vol => {
                    const volId = `${area.id}_${vol}`;
                    const hasItems = allStandards.some(s => s.areaId === k && s.volume === vol);
                    if (hasItems) {
                        nodes.push({
                            id: volId,
                            label: vol,
                            group: 'volume',
                            r: 15,
                            color: vol === 'ë„ë• 1' ? '#38bdf8' : '#f87171',
                            parentArea: area.id
                        });
                        links.push({ source: area.id, target: volId });

                        const stds = allStandards.filter(s => s.areaId === k && s.volume === vol);
                        stds.forEach(s => {
                            nodes.push({
                                id: s.id,
                                label: s.code,
                                group: 'standard',
                                r: 5,
                                color: area.color,
                                data: s
                            });
                            links.push({ source: volId, target: s.id });
                        });
                    }
                });
            });

            // Clear previous SVG if any
            d3.select(container).selectAll('svg').remove();

            const svg = d3.select(container).append('svg')
                .attr('width', width)
                .attr('height', height)
                .call(d3.zoom().scaleExtent([0.1, 4]).on('zoom', (event) => g.attr('transform', event.transform)));

            const g = svg.append('g');

            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(d => {
                    if (d.target.group === 'area') return 90;
                    if (d.target.group === 'volume') return 45; // Prevent overlap (25+15=40 radius sum)
                    return 18; // Physically touching distance (15+5=20 radius sum). 10 was too tight causing chaos.
                }).strength(d => d.target.group === 'area' ? 1 : 0.5))
                .force('charge', d3.forceManyBody().strength(-250))
                .force('radial', d3.forceRadial(d => d.group === 'area' ? 90 : 0, width / 2, height / 2).strength(d => d.group === 'area' ? 1 : 0))
                .force('collide', d3.forceCollide().radius(d => {
                    if (d.group === 'standard') return d.r + 1.5; // Prevent self-tangling (5 + 1.5)
                    if (d.group === 'volume') return d.r + 5;     // Buffer against Area
                    return d.r + 10;
                }).iterations(2)); // More iterations for stability

            const link = g.append('g').selectAll('line')
                .data(links).join('line')
                .attr('stroke', '#cbd5e1')
                .attr('stroke-width', 2)
                .attr('stroke-opacity', 0.2);

            // Standard Drag - Simplified to allow clicks
            const dragBehavior = d3.drag()
                .on('start', (event, d) => {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                })
                .on('drag', (event, d) => {
                    d.fx = event.x;
                    d.fy = event.y;
                })
                .on('end', (event, d) => {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                });

            const node = g.append('g').selectAll('.node')
                .data(nodes).join('g')
                .attr('class', 'node')
                .call(dragBehavior);

            // Node Circles with Glow Border
            node.append('circle')
                .attr('r', d => d.r)
                .attr('fill', d => d.color)
                .attr('stroke', '#fff')
                .attr('stroke-width', 3)
                .attr('fill-opacity', d => d.group === 'standard' ? 0.9 : 1)
                .style('filter', 'drop-shadow(0 0 8px rgba(255,255,255,0.8)) drop-shadow(0 0 15px rgba(255,255,255,0.4))');

            // Text Labels (Optimized for readability)
            node.append('text')
                .text(d => d.group === 'standard' ? '' : d.label)
                .attr('dy', d => d.group === 'area' ? '2.8em' : (d.group === 'volume' ? '2em' : '0.35em'))
                .attr('text-anchor', 'middle')
                .attr('fill', '#fff')
                .attr('font-weight', '700')
                .attr('font-size', d => d.group === 'root' ? '18px' : (d.group === 'area' ? '15px' : '10px'))
                .style('pointer-events', 'none')
                .style('text-shadow', '0 2px 4px rgba(0,0,0,0.8)');

            // --- INTERACTIONS ---
            const tooltip = d3.select('#graph-tooltip');

            node.on('mouseover', (event, d) => {
                const neighbors = new Set([d.id]);
                links.forEach(l => {
                    if (l.source.id === d.id) neighbors.add(l.target.id);
                    if (l.target.id === d.id) neighbors.add(l.source.id);
                });

                // Focus Effect
                node.transition().duration(200).style('opacity', n => neighbors.has(n.id) ? 1 : 0.1);
                link.transition().duration(200).style('stroke-opacity', l => (l.source.id === d.id || l.target.id === d.id) ? 1 : 0.05);

                if (d.group === 'standard') {
                    // Show tooltip
                    tooltip.style('display', 'block')
                        .html(`
                            <div class="tooltip-code">[${d.data.code}]</div>
                            <div class="tooltip-def">${d.data.definition}</div>
                        `);

                    // Visual feedback on hover
                    if (basket.has(d.id)) {
                        d3.select(event.currentTarget).select('circle').attr('stroke', '#FFD700').attr('stroke-opacity', 1);
                    } else {
                        d3.select(event.currentTarget).select('circle').attr('stroke', '#FFD700').attr('stroke-width', 3);
                    }
                }
            })
                .on('mousemove', (event, d) => {
                    if (d.group === 'standard') {
                        // Position tooltip near mouse
                        tooltip
                            .style('left', (event.pageX + 15) + 'px')
                            .style('top', (event.pageY - 10) + 'px');
                    }
                })
                .on('mouseout', (event, d) => {
                    node.transition().duration(200).style('opacity', 1);
                    link.transition().duration(200).style('stroke-opacity', 0.2);

                    if (d.group === 'standard') {
                        // Hide tooltip
                        tooltip.style('display', 'none');

                        // Restore selection state
                        if (basket.has(d.id)) {
                            d3.select(event.currentTarget).select('circle').attr('stroke', '#FFD700').attr('stroke-opacity', 1).attr('stroke-width', 4);
                        } else {
                            d3.select(event.currentTarget).select('circle').attr('stroke', '#fff').attr('stroke-width', 3);
                        }
                    }
                })
                .on('click', (event, d) => {
                    // Click Logic - Direct execution without checks
                    let keyword = '';
                    if (d.group === 'standard') {
                        console.log('Clicked standard:', d.id);
                        // 1. Toggle Selection (Basket)
                        if (basket.has(d.id)) {
                            basket.delete(d.id);
                            d3.select(event.currentTarget).select('circle').attr('stroke', '#fff').attr('stroke-width', 3);
                        } else {
                            basket.add(d.id);
                            d3.select(event.currentTarget).select('circle').attr('stroke', '#FFD700').attr('stroke-width', 4).attr('stroke-opacity', 1); // Yellow Highlight
                        }
                        renderBasket();

                        // 2. Search linked
                        keyword = d.data.code;
                        const input = document.getElementById('searchInput');
                        if (input) {
                            input.value = keyword;
                            handleSearchInput();
                        }
                    }
                    else if (d.group === 'volume') {
                        setFilter(d.label);
                    } else if (d.group === 'area') {
                        keyword = d.label;
                        const input = document.getElementById('searchInput');
                        if (input) {
                            input.value = keyword;
                            handleSearchInput();
                        }
                    } else {
                        setFilter('All');
                        const input = document.getElementById('searchInput');
                        if (input) {
                            input.value = '';
                            handleSearchInput();
                        }
                    }
                });

            simulation.on('tick', () => {
                link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);
                node.attr('transform', d => `translate(${d.x},${d.y})`);
            });

            window.addEventListener('resize', () => {
                const w = container.clientWidth;
                const h = container.clientHeight;
                svg.attr('width', w).attr('height', h);
                simulation.force('center', d3.forceCenter(w / 2, h / 2)).alpha(0.3).restart();
            });
        }

        // --- LIST & SEARCH ---
        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.toggle('active', b.innerText === (filter === 'HS' ? 'ê³ ë“±í•™êµ' : filter === 'All' ? 'ì „ì²´' : filter));
            });
            renderList();
        }

        function handleSearchInput() {
            renderList();
        }

        function renderList() {
            const list = document.getElementById('result-area');
            const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
            list.innerHTML = '';

            const filtered = allStandards.filter(s => {
                if (currentFilter === 'ë„ë• 1' && s.volume !== 'ë„ë• 1') return false;
                if (currentFilter === 'ë„ë• 2' && s.volume !== 'ë„ë• 2') return false;
                if (currentFilter === 'HS' && s.volume !== 'ê³ êµ') return false;
                // 'All' includes HS now.

                if (!keyword) return true;
                const rData = s.resource ? resourcesMap[s.resource] : null;
                const rTitle = rData ? rData.title : '';

                return s.definition.toLowerCase().includes(keyword) ||
                    s.code.toLowerCase().includes(keyword) ||
                    rTitle.toLowerCase().includes(keyword);
            });

            if (filtered.length === 0) {
                list.innerHTML = `<div style="text-align:center; color:#64748b; margin-top:30px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            filtered.forEach(s => {
                const card = document.createElement('div');
                card.className = 'card';

                // Add basket toggle on card click
                card.onclick = () => {
                    if (basket.has(s.id)) {
                        basket.delete(s.id);
                        card.style.background = 'rgba(255, 255, 255, 0.03)';
                        card.style.borderColor = 'var(--glass-border)';
                    } else {
                        basket.add(s.id);
                        card.style.background = 'rgba(255, 215, 0, 0.15)';
                        card.style.borderColor = '#FFD700';
                    }
                    renderBasket();
                };

                // Set initial visual state if already in basket
                if (basket.has(s.id)) {
                    card.style.background = 'rgba(255, 215, 0, 0.15)';
                    card.style.borderColor = '#FFD700';
                }

                let defHtml = s.definition;
                if (keyword) defHtml = defHtml.replaceAll(keyword, `<span class="hl">${keyword}</span>`);

                let resHtml = '';
                const rData = s.resource ? resourcesMap[s.resource] : null;

                if (rData) {
                    let tagBadge = '';
                    if (rData.tag) {
                        const colors = { 'ê·¸ë¦¼ì±…': '#F472B6', 'ì†Œì„¤': '#A78BFA', 'ì˜í™”': '#FBBF24', 'ì• ë‹ˆë©”ì´ì…˜': '#38BDF8', 'ë‹¤í': '#34D399', 'ì¸ë¬¸': '#60A5FA', 'ì—ì„¸ì´': '#E879F9' };
                        const bg = colors[rData.tag] || '#94a3b8';
                        tagBadge = `<span class="media-badge" style="background:${bg}; box-shadow:0 0 10px ${bg}66;">${rData.tag}</span>`;
                    }
                    resHtml = `<div class="card-res"><i data-lucide="book-open" size="16"></i> ${rData.title} ${tagBadge}</div>`;
                }

                card.innerHTML = `
                    <div class="card-header-row">
                        <span class="card-code">${s.code}</span>
                        <span class="card-vol" style="border:1px solid ${s.volume === 'ë„ë• 1' ? '#38bdf8' : (s.volume === 'ë„ë• 2' ? '#f87171' : '#fff')}">${s.volume}</span>
                    </div>
                    <div class="card-def">${defHtml}</div>
                    ${resHtml}
                `;
                list.appendChild(card);
            });
            lucide.createIcons();
        }

        function listScroll(direction) {
            const el = document.getElementById('result-area');
            el.scrollTo({ top: direction === 'top' ? 0 : el.scrollHeight, behavior: 'smooth' });
        }

        function renderBasket() {
            const listEl = document.getElementById('basket-list');
            const countEl = document.getElementById('basket-count');

            listEl.innerHTML = '';
            countEl.innerText = basket.size;

            if (basket.size === 0) {
                listEl.innerHTML = `<div style="text-align:center; color:#64748b; margin-top:20px; font-size:0.9rem;">ì„±ì·¨ê¸°ì¤€ ë…¸ë“œë¥¼ í´ë¦­í•´ ë‹´ìœ¼ì„¸ìš”.</div>`;
                return;
            }

            // Sync visual state of all nodes (in case of re-render)
            const circles = d3.selectAll('.node circle');
            circles.each(function (d) {
                if (d.group === 'standard') {
                    if (basket.has(d.id)) {
                        d3.select(this).attr('stroke', '#FFD700').attr('stroke-width', 4).attr('stroke-opacity', 1);
                    } else {
                        d3.select(this).attr('stroke', '#fff').attr('stroke-width', 3); // Reset to default
                    }
                }
            });

            basket.forEach(id => {
                const std = allStandards.find(s => s.id === id);
                if (!std) return;

                const item = document.createElement('div');
                item.className = 'basket-item';
                item.innerHTML = `
                    <div style="display:flex; align-items:center; overflow:hidden;">
                        <span class="b-code">[${std.code}]</span>
                        <span style="font-size:0.85rem; text-overflow:ellipsis; white-space:nowrap; overflow:hidden;">${std.definition}</span>
                    </div>
                    <div class="b-del" onclick="removeFromBasket('${id}')"><i data-lucide="x" size="16"></i></div>
                `;
                item.onclick = (e) => {
                    if (e.target.closest('.b-del')) return;
                    // Click item to search
                    const input = document.getElementById('searchInput');
                    input.value = std.code;
                    handleSearchInput();
                };
                listEl.appendChild(item);
            });
            lucide.createIcons();
        }

        function removeFromBasket(id) {
            basket.delete(id);
            renderBasket();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.main-view').forEach(el => {
                el.style.display = 'none';
                el.classList.remove('active');
            });

            // Activate
            if (tab === 'explore') {
                document.querySelector('.tab-item:nth-child(1)').classList.add('active');
                document.getElementById('view-explore').style.display = 'flex';
            } else if (tab === 'lesson') {
                document.querySelector('.tab-item:nth-child(2)').classList.add('active');
                document.getElementById('view-lesson').style.display = 'flex';
                renderLessonPlan();
            } else if (tab === 'assessment') {
                document.querySelector('.tab-item:nth-child(3)').classList.add('active');
                document.getElementById('view-assessment').style.display = 'flex';
                renderAssessmentPlan();
            } else if (tab === 'detail-plan') {
                document.querySelector('.tab-item:nth-child(4)').classList.add('active');
                document.getElementById('view-detail-plan').style.display = 'flex';
                renderDetailPlan();
            }
        }

        function renderDetailPlan() {
            const container = document.getElementById('instructional-design-table');
            container.innerHTML = '';

            if (basket.size === 0) {
                container.innerHTML = '<div class="paper"><h2>ìˆ˜ì—…ì§€ë„ì•ˆ</h2><p style="text-align:center; padding:30px;">ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ì„±ì·¨ê¸°ì¤€ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }

            basket.forEach(id => {
                const s = allStandards.find(item => item.id === id);
                if (!s) return;

                const areaName = AREA_MAP[s.areaId] ? AREA_MAP[s.areaId].fullName : 'ê¸°íƒ€';
                const suggested = suggestMethods(s.definition);
                const rData = s.resource ? resourcesMap[s.resource] : null;

                const paper = document.createElement('div');
                paper.className = 'paper';
                paper.style.marginBottom = '50px';

                let html = `
                    <h2>ìˆ˜ì—…ì§€ë„ì•ˆ (Gagne 9ë‹¨ê³„)</h2>
                    <table class="data-table" style="margin-bottom:25px;">
                        <tr>
                            <th width="15%">ì„±ì·¨ê¸°ì¤€</th>
                            <td colspan="3">[${s.code}] ${s.definition}</td>
                        </tr>
                        <tr>
                            <th width="15%">ë‹¨ì›ëª…</th>
                            <td width="35%">${s.volume} > ${areaName}</td>
                            <th width="15%">í•™ìŠµì£¼ì œ</th>
                            <td width="35%" contenteditable="true">${s.definition.split(' ')[0]} íƒêµ¬í•˜ê¸°</td>
                        </tr>
                    </table>

                    <table class="data-table" id="detail-plan-table-${s.code}">
                        <thead>
                            <tr>
                                <th width="10%">ë‹¨ê³„</th>
                                <th width="15%">ìˆ˜ì—… ì‚¬íƒœ</th>
                                <th width="45%">êµìˆ˜Â·í•™ìŠµ í™œë™ (ì „ëµ ìë™ ë§¤í•‘)</th>
                                <th width="30%">í•™ìŠµ ìë£Œ ë° ìœ ì˜ì  (ë…ì„œ ì „ëµ ì—°ë™)</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                GAGNE_EVENTS.forEach(event => {
                    let gagneStrategies = event.strategies.join(', ');
                    let activityHtml = `<div style="color:#64748b; font-size:0.8rem; margin-bottom:8px;">[ìˆ˜ì—…ì „ëµ] ${gagneStrategies}</div>`;
                    let notes = '';

                    // ë…ì„œ ì „ëµ ì—°ë™ (reading_strategy.ttl ê¸°ë°˜ ë™ì  ë§¤í•‘)
                    if (event.readingProcess) {
                        const strategies = recommendReadingStrategies(s.definition, event.readingProcess);
                        const primaryStrategy = strategies[0]; // ëŒ€í‘œ ì „ëµ ì„ íƒ

                        // í˜„ì¬ ì–´ë–¤ íƒ€ì…ìœ¼ë¡œ ë¶„ë¥˜ë˜ì—ˆëŠ”ì§€ ì‹ë³„
                        let textType = 'ì‚¬ì‹¤';
                        let badgeClass = 'badge-facts';
                        if (TEXT_TYPE_KEYWORDS['ì£¼ì¥'].some(k => s.definition.includes(k))) {
                            textType = 'ì£¼ì¥'; badgeClass = 'badge-argument';
                        } else if (TEXT_TYPE_KEYWORDS['ê°ìƒ'].some(k => s.definition.includes(k))) {
                            textType = 'ê°ìƒ'; badgeClass = 'badge-appreciation';
                        }

                        // êµ¬ì²´ì  í™œë™ ì˜ˆì‹œ ìƒì„±
                        const detailActivity = generateDetailedActivity(event, primaryStrategy, s.definition);
                        activityHtml += `<div class="activity-example">${detailActivity}</div>`;

                        notes = `<div class="reading-badge ${badgeClass}">${textType} ì¤‘ì‹¬ ì „ëµ</div>` +
                            `<div style="color:#0369a1; font-weight:600; font-size:0.8rem; margin-bottom:5px;">${event.readingProcess} ì¶”ì²œ ë¦¬ìŠ¤íŠ¸</div>`;

                        const bestInfo = getBestStrategyInfo(s.definition, event.readingProcess);

                        notes += strategies.map(st => {
                            const isBest = bestInfo && bestInfo.strategy === st;
                            const badge = isBest ? `<div class="best-badge tooltip-container" style="display:inline-flex; width:auto; border-bottom:none;">
                                â­ BEST
                                <div class="tooltip-text" style="width:250px; left:50%; margin-left:-125px; bottom:140%; top:auto;">
                                    <strong>í•™ìŠµ ëª©í‘œ:</strong><br>${bestInfo.goal}
                                </div>
                            </div><br>` : '';
                            const reason = isBest ? `<span class="recommend-reason">${bestInfo.reason}</span>` : '';
                            const tagClass = isBest ? 'strategy-tag best-tag' : 'strategy-tag';

                            return `${badge}<span class="${tagClass}" onclick="openActivityModal('${s.id}', '${st}', '${event.id}')">â€¢ ${st}</span>${reason}`;
                        }).join('<br>');
                    } else {
                        activityHtml += `<div class="activity-example">í™œë™ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</div>`;
                    }

                    // ë™ì  í™œë™ ì œì•ˆ (ë¯¸ë””ì–´)
                    if (event.step === 4 && rData) {
                        activityHtml += `<div style="margin-top:10px; padding:10px; background:rgba(225,29,72,0.05); border-radius:8px; border-left:4px solid #e11d48;">
                            <strong style="color:#e11d48;">[ë¯¸ë””ì–´ í™œìš©]</strong><br>'${rData.title}' (${rData.tag}) ìë£Œë¥¼ í™œìš©í•˜ì—¬ í•™ìŠµ ìê·¹ ì œê³µ
                        </div>`;
                    }

                    // ìˆ˜í–‰ ìœ ë„ (ê³¼ì œ)
                    if (event.step === 6) {
                        activityHtml += `<div style="margin-top:10px; padding:10px; background:rgba(37,99,235,0.05); border-radius:8px; border-left:4px solid #2563eb;">
                            <strong style="color:#2563eb;">[í™œë™ ì œì•ˆ]</strong><br>${suggested.task}
                        </div>`;
                    }

                    html += `
                        <tr data-event-id="${event.id}">
                            <td style="text-align:center; font-weight:700; color:#64748b;">${event.step === 1 || event.step === 2 ? 'ë„ì…' : (event.step >= 3 && event.step <= 7 ? 'ì „ê°œ' : 'ì •ë¦¬')}</td>
                            <td style="text-align:center; background:#f8fafc; font-weight:600;">${event.label}</td>
                            <td contenteditable="true" style="vertical-align:top; line-height:1.6; padding:15px;">${activityHtml}</td>
                            <td contenteditable="true" style="vertical-align:top; line-height:1.6; font-size:0.85rem; background:#f1f5f9; padding:15px;">${notes}</td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    <div class="ws-footer-guide">
                        ğŸ’¡ ì„±ì·¨ê¸°ì¤€ì— ë”± ë§ëŠ” <strong>ë² ìŠ¤íŠ¸ ì „ëµ</strong>ì„ ì„ íƒí•´ ë³´ì„¸ìš”. í™œë™ ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ í•™ìƒìš© í•™ìŠµì§€ì— ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.
                    </div>
                `;
                paper.innerHTML = html;
                container.appendChild(paper);
            });
            lucide.createIcons();
        }

        function renderLessonPlan() {
            const tbody = document.querySelector('#lesson-plan-table tbody');
            tbody.innerHTML = '';

            if (basket.size === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px;">ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ì„±ì·¨ê¸°ì¤€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            basket.forEach(id => {
                const s = allStandards.find(item => item.id === id);
                if (!s) return;
                const areaName = AREA_MAP[s.areaId] ? AREA_MAP[s.areaId].fullName : 'ê¸°íƒ€';

                // ìë™ êµìˆ˜Â·í•™ìŠµ ë°©ë²• ì œì•ˆ
                const suggested = suggestMethods(s.definition);
                const methodsText = suggested.methods.length > 0 ? suggested.methods.join('<br>') : '';

                // ìë™ í‰ê°€ ê³„íš ì œì•ˆ (ì²´í¬ë°•ìŠ¤)
                const assessmentHTML = ALL_ASSESSMENT_TYPES.map(type => {
                    const isChecked = suggested.assessments.includes(type);
                    return `<label style="display:block; margin:4px 0; font-size:0.85rem; text-align:left;">
                        <input type="checkbox" ${isChecked ? 'checked' : ''} style="margin-right:6px;">
                        ${type}
                    </label>`;
                }).join('');

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td contenteditable="true" style="cursor:text;"></td>
                    <td contenteditable="true" style="cursor:text;"></td>
                    <td>${s.volume} > ${areaName}</td>
                    <td>[${s.code}] ${s.definition}</td>
                    <td contenteditable="true" style="background:rgba(255,215,0,0.15); cursor:text; font-weight:600; padding:10px;">${methodsText}</td>
                    <td>${assessmentHTML}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderAssessmentPlan() {
            const tbody = document.querySelector('#assessment-plan-table tbody');
            tbody.innerHTML = '';

            if (basket.size === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:30px;">ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ì„±ì·¨ê¸°ì¤€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            basket.forEach(id => {
                const s = allStandards.find(item => item.id === id);
                if (!s) return;
                const areaData = AREA_MAP[s.areaId];
                const areaName = areaData ? areaData.fullName : 'ê¸°íƒ€';
                const competencies = areaData ? areaData.competencies : [];

                // ì—­ëŸ‰ ì²´í¬ë°•ìŠ¤ HTML ìƒì„±
                const competencyHTML = ALL_COMPETENCIES.map(comp => {
                    const isChecked = competencies.includes(comp);
                    return `<label style="display:block; margin:4px 0; font-size:0.85rem;">
                        <input type="checkbox" ${isChecked ? 'checked' : ''} style="margin-right:6px;">
                        ${comp}
                    </label>`;
                }).join('');

                // ìë™ ê³¼ì œ ë° ë£¨ë¸Œë¦­ ì œì•ˆ
                const suggested = suggestMethods(s.definition);

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${areaName}</td>
                    <td>${competencyHTML}</td>
                    <td>[${s.code}] ${s.definition}</td>
                    <td contenteditable="true" style="background:rgba(56,189,248,0.05); cursor:text; padding:12px; font-weight:600;">${suggested.task}</td>
                    <td contenteditable="true" style="background:rgba(56,189,248,0.05); cursor:text; padding:12px; white-space:pre-line; font-size:0.85rem;">${suggested.rubric}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function downloadExcel() {
            if (basket.size === 0) {
                alert('ë°”êµ¬ë‹ˆì— ì„±ì·¨ê¸°ì¤€ì„ ë‹´ì€ í›„ ì—‘ì…€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }

            // ëª¨ë“  ê³„íšì„œê°€ ë Œë”ë§ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (DOMì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë Œë”ë§ ì‹¤í–‰)
            const lessonRowsCount = document.querySelectorAll('#lesson-plan-table tbody tr').length;
            const assessRowsCount = document.querySelectorAll('#assessment-plan-table tbody tr').length;
            const detailPapersCount = document.getElementById('instructional-design-table').children.length;

            // ë°”êµ¬ë‹ˆì— ë‹´ê²¼ëŠ”ë° ë Œë”ë§ëœ í–‰ì´ ì—†ê±°ë‚˜ ì•ˆë‚´ ë¬¸êµ¬ë§Œ ìˆëŠ” ê²½ìš° ê°•ì œ ë Œë”ë§
            if (lessonRowsCount <= 1) renderLessonPlan();
            if (assessRowsCount <= 1) renderAssessmentPlan();
            if (detailPapersCount === 0) renderDetailPlan();

            const wb = XLSX.utils.book_new();

            // ì…€ ìŠ¤íƒ€ì¼(ì¤„ë°”ê¿ˆ ë“±) ì ìš©ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
            const applyStyles = (ws, wrapCols) => {
                if (!ws['!ref']) return;
                const range = XLSX.utils.decode_range(ws['!ref']);
                for (let R = range.s.r; R <= range.e.r; ++R) {
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const cellRef = XLSX.utils.encode_cell({ r: R, c: C });
                        if (!ws[cellRef]) continue;

                        // ìŠ¤íƒ€ì¼ ê°ì²´ ì´ˆê¸°í™”
                        if (!ws[cellRef].s) ws[cellRef].s = {};
                        if (!ws[cellRef].s.alignment) ws[cellRef].s.alignment = {};

                        // ê¸°ë³¸ ì •ë ¬: ì¤‘ì•™, ì¤‘ê°„
                        ws[cellRef].s.alignment.vertical = 'middle';

                        // ë°ì´í„° í–‰(í—¤ë” ì œì™¸)ì´ë©´ì„œ ì§€ì •ëœ ì»¬ëŸ¼ì¸ ê²½ìš° ì¤„ë°”ê¿ˆ ë° ìƒë‹¨ ì •ë ¬ ì ìš©
                        if (R > 0 && wrapCols.includes(C)) {
                            ws[cellRef].s.alignment.wrapText = true;
                            ws[cellRef].s.alignment.vertical = 'top';
                        } else if (R === 0) {
                            // í—¤ë”ëŠ” ì¤‘ì•™ ì •ë ¬
                            ws[cellRef].s.alignment.horizontal = 'center';
                        }
                    }
                }
            };

            // === ì‹œíŠ¸ 1: ìˆ˜ì—…ê³„íšì„œ ===
            const lessonRows = [['ì›”', 'ì£¼', 'ë‹¨ì›ëª…', 'ì„±ì·¨ê¸°ì¤€', 'êµìˆ˜Â·í•™ìŠµ ë°©ë²•', 'í‰ê°€ ê³„íš']];
            document.querySelectorAll('#lesson-plan-table tbody tr').forEach(tr => {
                const cells = tr.querySelectorAll('td');
                if (cells.length < 6) return;
                const row = Array.from(cells).slice(0, 5).map(c => c.innerText.trim());
                const checkedAssess = [];
                cells[5].querySelectorAll('label').forEach(lbl => {
                    if (lbl.querySelector('input').checked) checkedAssess.push(lbl.innerText.trim());
                });
                row.push(checkedAssess.join(', '));
                lessonRows.push(row);
            });
            const ws1 = XLSX.utils.aoa_to_sheet(lessonRows);
            ws1['!cols'] = [{ wch: 8 }, { wch: 8 }, { wch: 25 }, { wch: 60 }, { wch: 40 }, { wch: 30 }];
            applyStyles(ws1, [3, 4]); // ì„±ì·¨ê¸°ì¤€(3), êµìˆ˜Â·í•™ìŠµ ë°©ë²•(4) ì»¬ëŸ¼ ì¤„ë°”ê¿ˆ
            XLSX.utils.book_append_sheet(wb, ws1, 'ìˆ˜ì—…ê³„íšì„œ');

            // === ì‹œíŠ¸ 2: í‰ê°€ê³„íšì„œ ===
            const assessRows = [['í‰ê°€ ì˜ì—­', 'í•µì‹¬ ì—­ëŸ‰', 'ì„±ì·¨ê¸°ì¤€', 'ìˆ˜í–‰ ê³¼ì œ', 'ì±„ì  ê¸°ì¤€']];
            document.querySelectorAll('#assessment-plan-table tbody tr').forEach(tr => {
                const cells = tr.querySelectorAll('td');
                if (cells.length < 5) return;
                const row = [cells[0].innerText.trim()];
                const checkedComp = [];
                cells[1].querySelectorAll('label').forEach(lbl => {
                    if (lbl.querySelector('input').checked) checkedComp.push(lbl.innerText.trim());
                });
                row.push(checkedComp.join(', '));
                row.push(cells[2].innerText.trim()); // ì„±ì·¨ê¸°ì¤€
                row.push(cells[3].innerText.trim()); // ìˆ˜í–‰ ê³¼ì œ
                row.push(cells[4].innerText.trim()); // ì±„ì  ê¸°ì¤€
                assessRows.push(row);
            });
            const ws2 = XLSX.utils.aoa_to_sheet(assessRows);
            ws2['!cols'] = [{ wch: 25 }, { wch: 30 }, { wch: 60 }, { wch: 40 }, { wch: 50 }];
            applyStyles(ws2, [2]); // ì„±ì·¨ê¸°ì¤€(2) ì»¬ëŸ¼ ì¤„ë°”ê¿ˆ
            XLSX.utils.book_append_sheet(wb, ws2, 'í‰ê°€ê³„íšì„œ');

            // === ì‹œíŠ¸ 3: ìˆ˜ì—…ì§€ë„ì•ˆ ===
            const detailRows = [['ì„±ì·¨ê¸°ì¤€', 'ë‹¨ê³„', 'ìˆ˜ì—… ì‚¬íƒœ', 'êµìˆ˜Â·í•™ìŠµ í™œë™', 'í•™ìŠµ ìë£Œ ë° ìœ ì˜ì ']];
            const detailArea = document.getElementById('instructional-design-table');
            detailArea.querySelectorAll('.paper').forEach(paper => {
                const stdInfoCell = paper.querySelector('table:first-of-type tr:first-child td');
                const stdInfo = stdInfoCell ? stdInfoCell.innerText.trim() : '';
                const table = paper.querySelector('.data-table:last-of-type');
                if (table) {
                    table.querySelectorAll('tbody tr').forEach(tr => {
                        const cells = tr.querySelectorAll('td');
                        if (cells.length >= 4) {
                            detailRows.push([
                                stdInfo,
                                cells[0].innerText.trim(),
                                cells[1].innerText.trim(),
                                cells[2].innerText.trim(),
                                cells[3].innerText.trim()
                            ]);
                        }
                    });
                }
                detailRows.push(['', '', '', '', '']); // êµ¬ë¶„ì„  ëŒ€ì²´ ë¹ˆ í–‰
            });
            const ws3 = XLSX.utils.aoa_to_sheet(detailRows);
            ws3['!cols'] = [{ wch: 40 }, { wch: 10 }, { wch: 15 }, { wch: 80 }, { wch: 50 }];
            applyStyles(ws3, [0, 3]); // ì„±ì·¨ê¸°ì¤€(0), êµìˆ˜Â·í•™ìŠµ í™œë™(3) ì»¬ëŸ¼ ì¤„ë°”ê¿ˆ
            XLSX.utils.book_append_sheet(wb, ws3, 'ìˆ˜ì—…ì§€ë„ì•ˆ');

            XLSX.writeFile(wb, 'ë„ë•ê³¼_êµìœ¡ê³¼ì •_í†µí•©ê³„íš.xlsx');
        }

        async function downloadPDF(viewId) {
            const container = document.querySelector(`#${viewId} .plan-container`);
            if (!container) return;

            // PDF ì¶œë ¥ì„ ìœ„í•´ ë²„íŠ¼ ë“± UI ìš”ì†Œ ì„ì‹œ ìˆ¨ê¹€
            const actionBar = container.querySelector('.action-bar');
            const closeBtn = container.querySelector('.close-btn');
            if (actionBar) actionBar.style.visibility = 'hidden';
            if (closeBtn) closeBtn.style.visibility = 'hidden';

            const options = {
                margin: [10, 10, 10, 10],
                filename: `ë„ë•ê³¼_êµìœ¡ê³¼ì •_${viewId}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    letterRendering: true
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            try {
                // íŠ¹ì • ì˜ì—­(ì£¼ë¡œ .paper ë˜ëŠ” ì„¸ë¶€ ì§€ë„ì•ˆ ì˜ì—­)ì„ ì§€ì •í•˜ì—¬ ì¶œë ¥
                const content = (viewId === 'view-detail-plan')
                    ? container.querySelector('#instructional-design-table')
                    : container.querySelector('.paper');

                await html2pdf().set(options).from(content).save();
            } catch (error) {
                console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                if (actionBar) actionBar.style.visibility = 'visible';
                if (closeBtn) closeBtn.style.visibility = 'visible';
            }
        }

        function copyTable(tableId) {
            const el = document.getElementById(tableId);
            if (!el) return;

            const range = document.createRange();
            range.selectNode(el);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);

            try {
                // HTML í˜•ì‹ ìœ ì§€ë¥¼ ìœ„í•´ execCommand ì‚¬ìš© (ëŒ€ë¶€ë¶„ì˜ ì›Œë“œ/í•œê¸€ í”„ë¡œê·¸ë¨ì—ì„œ HTML í˜•ì‹ì„ ì§€ì›í•¨)
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('í‘œ ì–‘ì‹ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•œê¸€(HWP)ì´ë‚˜ ì›Œë“œì— [ì›ë³¸ ì„œì‹ ìœ ì§€]ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
                }
            } catch (err) {
                console.error('ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            window.getSelection().removeAllRanges();
        }

        // --- ACTIVITY MODAL LOGIC ---
        let currentModalContext = { stdId: null, strategy: null, eventId: null };

        function openActivityModal(stdId, strategy, eventId) {
            const std = allStandards.find(s => s.id === stdId);
            if (!std) return;

            currentModalContext = { stdId, strategy, eventId };

            const modal = document.getElementById('activity-modal');
            const infoBar = document.getElementById('modal-info');

            infoBar.innerHTML = `<strong>ì„±ì·¨ê¸°ì¤€:</strong> [${std.code}] ${std.definition} | <strong>ì „ëµ:</strong> <span style="color:var(--vol-1)">${strategy}</span> | <strong>ì‚¬íƒœ:</strong> ${eventId}`;

            // ì „ëµë³„ ë¶„ê¸° ì²˜ë¦¬ ì¤€ë¹„
            renderActivityUI(strategy, stdId, eventId);

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeActivityModal() {
            document.getElementById('activity-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function renderActivityUI(strategy, stdId, eventId) {
            const body = document.getElementById('modal-body');
            const saveBtn = document.getElementById('save-activity-btn');
            saveBtn.innerText = "ì‘ì„± ì™„ë£Œ (ì§€ë„ì•ˆ ë°˜ì˜)";

            // ë°ì´í„° êµ¬ì¡°: stdId -> { eventId -> { strategy, data } }
            if (!activityDataStore[stdId]) activityDataStore[stdId] = {};
            if (!activityDataStore[stdId][eventId]) activityDataStore[stdId][eventId] = { strategy, data: {} };

            // ë§Œì•½ í´ë¦­í•œ ì „ëµì´ ì´ì „ì— ì €ì¥ëœ ì „ëµê³¼ ë‹¤ë¥´ë‹¤ë©´ ë°ì´í„° ì´ˆê¸°í™” (ì„ íƒ ì‚¬í•­)
            if (activityDataStore[stdId][eventId].strategy !== strategy) {
                activityDataStore[stdId][eventId] = { strategy, data: {} };
            }

            const data = activityDataStore[stdId][eventId].data;

            // ì‹¤ì‹œê°„ ì €ì¥ í—¬í¼: íŠ¹ì • ì‚¬íƒœì˜ ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
            window.updateActivityState = (key, val) => {
                activityDataStore[stdId][eventId].data[key] = val;
            };

            switch (strategy) {
                case 'KWL':
                    body.innerHTML = `
                        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px;">
                            <div style="background:#fefce8; padding:20px; border-radius:12px; border:1px solid #fef08a;">
                                <h4 style="margin-top:0; color:#854d0e;">[K] ì•Œê³  ìˆëŠ” ê²ƒ</h4>
                                <p style="font-size:0.8rem; color:#a16207; margin-bottom:10px;">ì´ ì£¼ì œì— ëŒ€í•´ ì´ë¯¸ ì•Œê³  ìˆëŠ” ë‚´ìš©ì„ ì ì–´ë³´ì„¸ìš”.</p>
                                <textarea style="width:100%; height:250px; border:1px solid #fde047; border-radius:8px; padding:12px; font-size:0.9rem;" 
                                    oninput="updateActivityState('k', this.value)" placeholder="ì´ë¯¸ ì•Œê³  ìˆëŠ” ì‚¬ì‹¤ì´ë‚˜ ê²½í—˜...">${data.k || ''}</textarea>
                            </div>
                            <div style="background:#eff6ff; padding:20px; border-radius:12px; border:1px solid #dbeafe;">
                                <h4 style="margin-top:0; color:#1e40af;">[W] ì•Œê³  ì‹¶ì€ ê²ƒ</h4>
                                <p style="font-size:0.8rem; color:#2563eb; margin-bottom:10px;">ì´ ì£¼ì œì—ì„œ ê¶ê¸ˆí•˜ê±°ë‚˜ ë” ë°°ìš°ê³  ì‹¶ì€ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
                                <textarea style="width:100%; height:250px; border:1px solid #bfdbfe; border-radius:8px; padding:12px; font-size:0.9rem;" 
                                    oninput="updateActivityState('w', this.value)" placeholder="ì§ˆë¬¸ì´ë‚˜ íƒêµ¬í•˜ê³  ì‹¶ì€ ë‚´ìš©...">${data.w || ''}</textarea>
                            </div>
                            <div style="background:#f0fdf4; padding:20px; border-radius:12px; border:1px solid #dcfce7;">
                                <h4 style="margin-top:0; color:#166534;">[L] ìƒˆë¡œ ë°°ìš´ ê²ƒ</h4>
                                <p style="font-size:0.8rem; color:#16a34a; margin-bottom:10px;">í™œë™ì„ í†µí•´ ìƒˆë¡­ê²Œ ê¹¨ë‹«ê±°ë‚˜ ì•Œê²Œ ëœ ì ì„ ì •ë¦¬í•´ ë³´ì„¸ìš”.</p>
                                <textarea style="width:100%; height:250px; border:1px solid #bbf7d0; border-radius:8px; padding:12px; font-size:0.9rem;" 
                                    oninput="updateActivityState('l', this.value)" placeholder="ë°°ìš´ ë‚´ìš©ê³¼ ëŠë‚€ ì ...">${data.l || ''}</textarea>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'SQ3R':
                    const currentStep = data.step || 0;
                    const steps = [
                        { id: 's', label: 'í›‘ì–´ë³´ê¸°', desc: 'ì œëª©, ëª©ì°¨, ê·¸ë¦¼ì„ ë³´ê³  ì „ì²´ ë‚´ìš©ì„ íŒŒì•…í•˜ì„¸ìš”.' },
                        { id: 'q', label: 'ì§ˆë¬¸í•˜ê¸°', desc: 'ë‚´ìš©ì„ ì½ìœ¼ë©° í•´ê²°í•˜ê³  ì‹¶ì€ ì§ˆë¬¸ì„ ë§Œë“œì„¸ìš”.' },
                        { id: 'r1', label: 'ì½ê¸°', desc: 'ì§ˆë¬¸ì˜ ë‹µì„ ì°¾ìœ¼ë©° ìì„¸íˆ ì½ìœ¼ì„¸ìš”.' },
                        { id: 'r2', label: 'ì•”ì†¡', desc: 'ì½ì€ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ì¤‘ìš”í•œ ë¶€ë¶„ì„ ìš”ì•½í•˜ì„¸ìš”.' },
                        { id: 'r3', label: 'ë³µìŠµ', desc: 'ì „ì²´ ë‚´ìš©ì„ ë‹¤ì‹œ í•œë²ˆ ì •ë¦¬í•˜ì„¸ìš”.' }
                    ];

                    body.innerHTML = `
                        <div style="background:#f1f5f9; padding:40px; border-radius:24px; max-width:800px; margin:0 auto;">
                            <!-- Progress Bar -->
                            <div style="display:flex; justify-content:space-between; margin-bottom:40px; position:relative;">
                                <div style="position:absolute; top:20px; left:0; width:100%; height:4px; background:#e2e8f0; z-index:0;"></div>
                                <div style="position:absolute; top:20px; left:0; width:${(currentStep / 4) * 100}%; height:4px; background:var(--vol-1); z-index:0; transition:width 0.4s ease;"></div>
                                ${steps.map((s, idx) => `
                                    <div style="z-index:1; text-align:center;">
                                        <div style="width:40px; height:40px; border-radius:50%; background:${idx <= currentStep ? 'var(--vol-1)' : '#fff'}; color:${idx <= currentStep ? '#fff' : '#94a3b8'}; border:2px solid ${idx <= currentStep ? 'var(--vol-1)' : '#e2e8f0'}; display:flex; align-items:center; justify-content:center; font-weight:800; margin-bottom:10px; transition:all 0.3s; cursor:pointer;"
                                            onclick="updateActivityState('step', ${idx}); renderActivityUI('${strategy}', '${stdId}', '${eventId}')">
                                            ${idx + 1}
                                        </div>
                                        <span style="font-size:0.8rem; font-weight:700; color:${idx <= currentStep ? 'var(--vol-1)' : '#64748b'};">${s.label}</span>
                                    </div>
                                `).join('')}
                            </div>

                            <!-- Step Content -->
                            <div style="background:#fff; padding:30px; border-radius:16px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);">
                                <h3 style="margin-top:0; color:var(--vol-1); display:flex; align-items:center; gap:10px;">
                                    <span style="background:var(--vol-1); color:#fff; padding:4px 12px; border-radius:8px; font-size:1rem;">ë‹¨ê³„ ${currentStep + 1}</span>
                                    ${steps[currentStep].label}
                                </h3>
                                <p style="color:#64748b; margin-bottom:20px; font-size:0.95rem;">${steps[currentStep].desc}</p>
                                <textarea style="width:100%; height:180px; border:2px solid #f1f5f9; border-radius:12px; padding:20px; font-size:1.1rem; line-height:1.6; outline:none; transition:border-color 0.2s;"
                                    onfocus="this.style.borderColor='var(--vol-1)'"
                                    onblur="this.style.borderColor='#f1f5f9'"
                                    oninput="updateActivityState('${steps[currentStep].id}', this.value)" 
                                    placeholder="ì—¬ê¸°ì— ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”...">${data[steps[currentStep].id] || ''}</textarea>
                                
                                <div style="display:flex; justify-content:space-between; margin-top:30px;">
                                    <button style="padding:10px 20px; border:none; background:#f1f5f9; border-radius:8px; font-weight:700; color:#64748b; cursor:pointer;"
                                        ${currentStep === 0 ? 'disabled style="opacity:0.5; cursor:default;"' : ''}
                                        onclick="updateActivityState('step', ${currentStep - 1}); renderActivityUI('${strategy}', '${stdId}', '${eventId}')">ì´ì „ ë‹¨ê³„</button>
                                    
                                    ${currentStep < 4 ? `
                                        <button style="padding:10px 25px; border:none; background:var(--vol-2); border-radius:8px; font-weight:700; color:#fff; cursor:pointer; box-shadow:0 4px 6px rgba(139,92,246,0.2);"
                                            onclick="updateActivityState('step', ${currentStep + 1}); renderActivityUI('${strategy}', '${stdId}', '${eventId}')">ë‹¤ìŒ ë‹¨ê³„</button>
                                    ` : `
                                        <div style="background:var(--vol-1); color:#fff; padding:10px 20px; border-radius:8px; font-weight:800; animation:pulse 2s infinite;">ë§ˆì§€ë§‰ ë‹¨ê³„ì…ë‹ˆë‹¤! ìµœì¢… ì‘ì„±ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
                                    `}
                                </div>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ë§ˆì¸ë“œë§µ':
                    body.innerHTML = `
                        <div style="background:#f0f9ff; padding:40px; border-radius:24px; border:1px solid #bae6fd; position:relative; overflow:hidden;">
                            <h4 style="margin-top:0; color:#0369a1; text-align:center; font-size:1.5rem; margin-bottom:40px;">ìƒê°ì˜ ë‚˜ë¬´ (Mind Map)</h4>
                            
                            <!-- Tree Visualization (Conceptual) -->
                            <div style="display:flex; flex-direction:column; align-items:center; gap:30px; position:relative;">
                                <!-- Top Branches -->
                                <div style="display:flex; gap:100px;">
                                    <div class="mindmap-node" style="background:#fff; padding:15px; border-radius:15px; border:2px solid #7dd3fc; width:200px; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                                        <label style="display:block; font-weight:800; color:#0284c7; margin-bottom:8px;">1. í•µì‹¬ë‚´ìš©</label>
                                        <textarea style="width:100%; height:60px; border:none; outline:none; resize:none;" oninput="updateActivityState('b1', this.value)">${data.b1 || ''}</textarea>
                                    </div>
                                    <div class="mindmap-node" style="background:#fff; padding:15px; border-radius:15px; border:2px solid #7dd3fc; width:200px; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                                        <label style="display:block; font-weight:800; color:#0284c7; margin-bottom:8px;">2. ì„¸ë¶€ì‚¬í•­</label>
                                        <textarea style="width:100%; height:60px; border:none; outline:none; resize:none;" oninput="updateActivityState('b2', this.value)">${data.b2 || ''}</textarea>
                                    </div>
                                </div>

                                <!-- Center Root -->
                                <div style="background:var(--vol-1); padding:25px; border-radius:50px; width:250px; text-align:center; color:#fff; box-shadow:0 10px 15px rgba(0,0,0,0.1); border:4px solid #fff; z-index:2;">
                                    <label style="display:block; font-size:0.8rem; font-weight:800; margin-bottom:5px; opacity:0.9;">ì¤‘ì‹¬ ì£¼ì œ</label>
                                    <input type="text" style="width:100%; border:none; background:transparent; text-align:center; font-weight:800; color:#fff; font-size:1.2rem; outline:none;" 
                                        oninput="updateActivityState('center', this.value)" value="${data.center || ''}" placeholder="ì£¼ì œ ì…ë ¥">
                                </div>

                                <!-- Bottom Branches -->
                                <div style="display:flex; gap:100px;">
                                    <div class="mindmap-node" style="background:#fff; padding:15px; border-radius:15px; border:2px solid #7dd3fc; width:200px; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                                        <label style="display:block; font-weight:800; color:#0284c7; margin-bottom:8px;">3. ê´€ë ¨ì‚¬ë¡€</label>
                                        <textarea style="width:100%; height:60px; border:none; outline:none; resize:none;" oninput="updateActivityState('b3', this.value)">${data.b3 || ''}</textarea>
                                    </div>
                                    <div class="mindmap-node" style="background:#fff; padding:15px; border-radius:15px; border:2px solid #7dd3fc; width:200px; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                                        <label style="display:block; font-weight:800; color:#0284c7; margin-bottom:8px;">4. ë‚˜ì˜ìƒê°</label>
                                        <textarea style="width:100%; height:60px; border:none; outline:none; resize:none;" oninput="updateActivityState('b4', this.value)">${data.b4 || ''}</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ì‚¬ê±´ íë¦„ë„':
                    body.innerHTML = `
                        <div style="background:#faf5ff; padding:40px; border-radius:24px; border:1px solid #e9d5ff;">
                            <h4 style="margin-top:0; color:#7e22ce; margin-bottom:30px; text-align:center; font-size:1.5rem;">ì‚¬ê±´ íë¦„ë„ (Sequence Chart)</h4>
                            <div style="display:flex; flex-direction:column; gap:20px; max-width:600px; margin:0 auto;">
                                <div style="background:white; padding:25px; border-radius:20px; border:2px solid #d8b4fe; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                                    <div style="display:flex; align-items:center; gap:12px; margin-bottom:15px; color:#7e22ce; font-weight:800;">
                                        <span style="background:#7e22ce; color:#fff; width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:0.8rem;">1</span>
                                        [ë°œë‹¨] ì‚¬ê±´ì˜ ì‹œì‘
                                    </div>
                                    <textarea style="width:100%; height:100px; border:none; outline:none; font-size:1rem; line-height:1.6;" oninput="updateActivityState('start', this.value)" placeholder="ì–¸ì œ, ì–´ë””ì„œ, ëˆ„ê°€ ìˆëŠ”ì§€ ì ì–´ë³´ì„¸ìš”.">${data.start || ''}</textarea>
                                </div>

                                <div style="display:flex; justify-content:center; color:#d8b4fe;"><i data-lucide="chevrons-down" size="32"></i></div>

                                <div style="background:white; padding:25px; border-radius:20px; border:3px solid #7e22ce; box-shadow:0 8px 15px rgba(126,34,206,0.1);">
                                    <div style="display:flex; align-items:center; gap:12px; margin-bottom:15px; color:#7e22ce; font-weight:800;">
                                        <span style="background:#7e22ce; color:#fff; width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:0.8rem;">2</span>
                                        [ì „ê°œ] ì£¼ìš” ê°ˆë“±
                                    </div>
                                    <textarea style="width:100%; height:120px; border:none; outline:none; font-size:1rem; line-height:1.6;" oninput="updateActivityState('process', this.value)" placeholder="ë¬¸ì œ ìƒí™©ê³¼ ê°ˆë“± ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì ì–´ë³´ì„¸ìš”.">${data.process || ''}</textarea>
                                </div>

                                <div style="display:flex; justify-content:center; color:#d8b4fe;"><i data-lucide="chevrons-down" size="32"></i></div>

                                <div style="background:white; padding:25px; border-radius:20px; border:2px solid #d8b4fe; box-shadow:0 4px 6px rgba(0,0,0,0.05);">
                                    <div style="display:flex; align-items:center; gap:12px; margin-bottom:15px; color:#7e22ce; font-weight:800;">
                                        <span style="background:#7e22ce; color:#fff; width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:0.8rem;">3</span>
                                        [ê²°ë§] í•´ê²° ë° ê²°ê³¼
                                    </div>
                                    <textarea style="width:100%; height:100px; border:none; outline:none; font-size:1rem; line-height:1.6;" oninput="updateActivityState('end', this.value)" placeholder="ì‚¬ê±´ì´ ì–´ë–»ê²Œ í•´ê²°ë˜ì—ˆê³  ì–´ë–¤ êµí›ˆì„ ì£¼ë‚˜ìš”?">${data.end || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ì›ì¸ê³¼ ê²°ê³¼':
                    body.innerHTML = `
                        <div style="background:#f0fdf4; padding:40px; border-radius:24px; border:1px solid #bbf7d0;">
                            <h4 style="margin-top:0; color:#15803d; margin-bottom:30px; text-align:center; font-size:1.5rem;">ì›ì¸ê³¼ ê²°ê³¼ ë¶„ì„</h4>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:40px; position:relative;">
                                <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; border:4px solid #16a34a; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; z-index:2; color:#16a34a;">
                                    <i data-lucide="arrow-right-left" size="30"></i>
                                </div>
                                <div style="background:white; padding:30px; border-radius:20px; border:2px dashed #15803d; box-shadow:0 4px 6px rgba(0,0,0,0.02);">
                                    <label style="display:flex; align-items:center; gap:10px; font-weight:800; color:#15803d; margin-bottom:20px; font-size:1.1rem;">
                                        <i data-lucide="help-circle"></i> [ì›ì¸] ì™œ ì¼ì–´ë‚¬ë‚˜ìš”?
                                    </label>
                                    <textarea style="width:100%; height:250px; border:none; outline:none; font-size:1rem; line-height:1.7;" oninput="updateActivityState('cause', this.value)" placeholder="ì‚¬ê±´ì´ë‚˜ ìƒí™©ì´ ë°œìƒí•œ ê·¼ë³¸ì ì¸ ì´ìœ ë¥¼ ê¸°ë¡í•˜ì„¸ìš”.">${data.cause || ''}</textarea>
                                </div>
                                <div style="background:white; padding:30px; border-radius:20px; border:3px solid #16a34a; box-shadow:0 10px 15px rgba(22,163,74,0.05);">
                                    <label style="display:flex; align-items:center; gap:10px; font-weight:800; color:#16a34a; margin-bottom:20px; font-size:1.1rem;">
                                        <i data-lucide="alert-circle"></i> [ê²°ê³¼] ì–´ë–¤ ì¼ì´ ìƒê²¼ë‚˜ìš”?
                                    </label>
                                    <textarea style="width:100%; height:250px; border:none; outline:none; font-size:1rem; line-height:1.7;" oninput="updateActivityState('effect', this.value)" placeholder="ê·¸ ì›ì¸ìœ¼ë¡œ ì¸í•´ ë‚˜íƒ€ë‚œ ë³€í™”ë‚˜ ì‚¬ê±´ì˜ ê²°ê³¼ë¥¼ ê¸°ë¡í•˜ì„¸ìš”.">${data.effect || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ë¹„êµì™€ ëŒ€ì¡°':
                    body.innerHTML = `
                        <div style="background:#fff7ed; padding:40px; border-radius:24px; border:1px solid #ffedd5;">
                            <h4 style="margin-top:0; color:#c2410c; margin-bottom:30px; text-align:center; font-size:1.5rem;">ë¹„êµì™€ ëŒ€ì¡° (Venn Diagram)</h4>
                            <div style="display:flex; justify-content:center; height:450px; position:relative;">
                                <!-- Left Circle (A) -->
                                <div style="width:350px; height:350px; background:#fff; border:3px solid #fb923c; border-radius:50%; position:absolute; left:50px; top:0; padding:60px 80px 40px 40px; box-shadow:inset 0 0 20px rgba(251,146,60,0.05);">
                                    <input type="text" style="width:100%; border:none; border-bottom:1px solid #fdba74; font-weight:800; color:#c2410c; margin-bottom:15px; outline:none;" 
                                        placeholder="ëŒ€ìƒ A ì…ë ¥" oninput="updateActivityState('targetA', this.value)" value="${data.targetA || ''}">
                                    <textarea style="width:100%; height:180px; border:none; outline:none; background:transparent; font-size:0.95rem; line-height:1.6;" 
                                        placeholder="Aë§Œì˜ ë…íŠ¹í•œ íŠ¹ì§•..." oninput="updateActivityState('a', this.value)">${data.a || ''}</textarea>
                                </div>
                                <!-- Right Circle (B) -->
                                <div style="width:350px; height:350px; background:#fff; border:3px solid #fb923c; border-radius:50%; position:absolute; right:50px; top:0; padding:60px 40px 40px 80px; box-shadow:inset 0 0 20px rgba(251,146,60,0.05);">
                                    <input type="text" style="width:100%; border:none; border-bottom:1px solid #fdba74; font-weight:800; color:#c2410c; margin-bottom:15px; outline:none; text-align:right;" 
                                        placeholder="ëŒ€ìƒ B ì…ë ¥" oninput="updateActivityState('targetB', this.value)" value="${data.targetB || ''}">
                                    <textarea style="width:100%; height:180px; border:none; outline:none; background:transparent; font-size:0.95rem; line-height:1.6; text-align:right;" 
                                        placeholder="Bë§Œì˜ ë…íŠ¹í•œ íŠ¹ì§•..." oninput="updateActivityState('b', this.value)">${data.b || ''}</textarea>
                                </div>
                                <!-- Intersection (Common) -->
                                <div style="width:220px; height:220px; background:rgba(255,255,255,0.9); border:3px solid #ea580c; border-radius:50%; position:absolute; left:50%; top:65px; transform:translateX(-50%); z-index:2; padding:40px 20px; display:flex; flex-direction:column; align-items:center; box-shadow:0 10px 15px rgba(234,88,12,0.1);">
                                    <label style="font-weight:900; color:#ea580c; margin-bottom:10px;">ê³µí†µì </label>
                                    <textarea style="width:100%; height:120px; border:none; outline:none; background:transparent; text-align:center; font-size:0.95rem; line-height:1.5; font-weight:600;" 
                                        placeholder="ë‘˜ì˜ ë¹„ìŠ·í•œ ì ..." oninput="updateActivityState('common', this.value)">${data.common || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ìºë¦­í„° ì°¨íŠ¸':
                    body.innerHTML = `
                        <div style="background:#f8fafc; padding:30px; border-radius:16px; border:1px solid #e2e8f0;">
                            <h4 style="margin-top:0; margin-bottom:20px; color:#334155;"><i data-lucide="users" style="vertical-align:middle; margin-right:8px;"></i> ì¸ë¬¼ ë¶„ì„ ì°¨íŠ¸</h4>
                            <table class="data-table" style="background:white; border-collapse:collapse; width:100%;">
                                <tr>
                                    <th width="25%" style="background:#f1f5f9; border:1px solid #e2e8f0; padding:12px;">ì¸ë¬¼ ì´ë¦„</th>
                                    <td style="border:1px solid #e2e8f0; padding:0;"><input type="text" style="width:100%; border:none; padding:12px; outline:none;" 
                                        oninput="updateActivityState('name', this.value)" value="${data.name || ''}" placeholder="ì¸ë¬¼ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."></td>
                                </tr>
                                <tr>
                                    <th style="background:#f1f5f9; border:1px solid #e2e8f0; padding:12px;">ì„±ê²© ë° íŠ¹ì§•</th>
                                    <td style="border:1px solid #e2e8f0; padding:0;"><textarea style="width:100%; height:80px; border:none; padding:12px; outline:none; resize:none;" 
                                        oninput="updateActivityState('trait', this.value)" placeholder="ì„±ê²©, ê°€ì¹˜ê´€, ì²˜í•œ ìƒí™© ë“±">${data.trait || ''}</textarea></td>
                                </tr>
                                <tr>
                                    <th style="background:#f1f5f9; border:1px solid #e2e8f0; padding:12px;">ì£¼ìš” ëŒ€ì‚¬/í–‰ë™</th>
                                    <td style="border:1px solid #e2e8f0; padding:0;"><textarea style="width:100%; height:100px; border:none; padding:12px; outline:none; resize:none;" 
                                        oninput="updateActivityState('action', this.value)" placeholder="ì¸ìƒ ê¹Šì€ ë§ì´ë‚˜ ê²°ì •ì ì¸ í–‰ë™">${data.action || ''}</textarea></td>
                                </tr>
                                <tr>
                                    <th style="background:#f1f5f9; border:1px solid #e2e8f0; padding:12px;">ì¸ë¬¼ì— ëŒ€í•œ ë‚˜ì˜ í‰ê°€</th>
                                    <td style="border:1px solid #e2e8f0; padding:0;"><textarea style="width:100%; height:100px; border:none; padding:12px; outline:none; resize:none;" 
                                        oninput="updateActivityState('eval', this.value)" placeholder="ë‚˜ì˜€ë‹¤ë©´ ì–´ë• ì„ì§€, ì¸ë¬¼ì˜ ì„ íƒì— ëŒ€í•œ ìƒê°">${data.eval || ''}</textarea></td>
                                </tr>
                            </table>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'QAR':
                    body.innerHTML = `
                        <div style="background:#fef2f2; padding:30px; border-radius:16px; border:1px solid #fecaca;">
                            <h4 style="margin-top:0; color:#991b1b; margin-bottom:20px;">ì§ˆë¬¸-ë‹µë³€ ê´€ê³„ (QAR)</h4>
                            <div style="margin-bottom:20px;">
                                <label style="display:block; font-weight:700; margin-bottom:8px;">1. ë‚˜ì˜ ì§ˆë¬¸</label>
                                <textarea style="width:100%; height:80px; border:1px solid #fca5a5; border-radius:8px; padding:12px;" 
                                    oninput="updateActivityState('q', this.value)" placeholder="í…ìŠ¤íŠ¸ì—ì„œ ê¶ê¸ˆí•œ ì ì„ ì§ˆë¬¸ìœ¼ë¡œ ë§Œë“¤ì–´ ë³´ì„¸ìš”.">${data.q || ''}</textarea>
                            </div>
                            <div style="margin-bottom:20px;">
                                <label style="display:block; font-weight:700; margin-bottom:8px;">2. ì§ˆë¬¸ ìœ í˜• ì„ íƒ</label>
                                <select style="width:100%; padding:12px; border:1px solid #fca5a5; border-radius:8px; outline:none;" 
                                    onchange="updateActivityState('type', this.value)">
                                    <option value="" ${!data.type ? 'selected' : ''}>--- ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš” ---</option>
                                    <option value="ë°”ë¡œ ì—¬ê¸°" ${data.type === 'ë°”ë¡œ ì—¬ê¸°' ? 'selected' : ''}>ë°”ë¡œ ì—¬ê¸° (ë‹µì´ ê¸€ì— ì§ì ‘ ëª…ì‹œë¨)</option>
                                    <option value="ìƒê°í•˜ê³  ì°¾ê¸°" ${data.type === 'ìƒê°í•˜ê³  ì°¾ê¸°' ? 'selected' : ''}>ìƒê°í•˜ê³  ì°¾ê¸° (ê¸€ì˜ ì—¬ëŸ¬ ë¶€ë¶„ì„ ì¢…í•©í•´ì•¼ í•¨)</option>
                                    <option value="ì €ìì™€ ë‚˜" ${data.type === 'ì €ìì™€ ë‚˜' ? 'selected' : ''}>ì €ìì™€ ë‚˜ (ë‚˜ì˜ ë°°ê²½ì§€ì‹ê³¼ ê¸€ì˜ ì •ë³´ë¥¼ ì—°ê²°í•´ì•¼ í•¨)</option>
                                </select>
                            </div>
                            <div>
                                <label style="display:block; font-weight:700; margin-bottom:8px;">3. ë‹µë³€ ë‚´ìš©</label>
                                <textarea style="width:100%; height:120px; border:1px solid #fca5a5; border-radius:8px; padding:12px;" 
                                    oninput="updateActivityState('a', this.value)" placeholder="ì„ íƒí•œ ìœ í˜•ì— ë§ì¶° ë‹µë³€ì„ ìƒì„¸íˆ ì ì–´ë³´ì„¸ìš”.">${data.a || ''}</textarea>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°':
                    body.innerHTML = `
                        <div style="background:#fff7ed; padding:30px; border-radius:16px; border:1px solid #ffedd5;">
                            <h4 style="margin-top:0; color:#9a3412; margin-bottom:20px;">ë…ì„œ ì „: ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°</h4>
                            <div style="margin-bottom:25px;">
                                <label style="display:block; font-weight:700; margin-bottom:8px; color:#c2410c;">[ì§ˆë¬¸ 1] ì œëª©ê³¼ ì‚½í™”ë¥¼ ë³´ê³  ì˜ˆìƒë˜ëŠ” ë‚´ìš©ì€ ë¬´ì—‡ì¸ê°€ìš”?</label>
                                <textarea style="width:100%; height:120px; border:1px solid #fed7aa; border-radius:8px; padding:15px; font-size:1rem;" 
                                    oninput="updateActivityState('p1', this.value)" placeholder="ì–´ë–¤ ì´ì•¼ê¸°ê°€ í¼ì³ì§ˆì§€ ìƒìƒí•´ ë³´ì„¸ìš”.">${data.p1 || ''}</textarea>
                            </div>
                            <div>
                                <label style="display:block; font-weight:700; margin-bottom:8px; color:#c2410c;">[ì§ˆë¬¸ 2] ê·¸ë ‡ê²Œ ìƒê°í•œ ê·¼ê±°ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</label>
                                <textarea style="width:100%; height:120px; border:1px solid #fed7aa; border-radius:8px; padding:15px; font-size:1rem;" 
                                    oninput="updateActivityState('p2', this.value)" placeholder="ì‚½í™”ì˜ íŠ¹ì§•ì´ë‚˜ ì œëª©ì˜ í‚¤ì›Œë“œ ë“± ê·¼ê±°ë¥¼ ì ì–´ë³´ì„¸ìš”.">${data.p2 || ''}</textarea>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                case 'ìš”ì•½í•˜ê¸°':
                    body.innerHTML = `
                        <div style="background:#f0f9ff; padding:30px; border-radius:16px; border:1px solid #bae6fd;">
                            <h4 style="margin-top:0; color:#0369a1; margin-bottom:20px;">ë…ì„œ í›„: ìš”ì•½í•˜ê¸°</h4>
                            <div style="margin-bottom:20px;">
                                <label style="display:block; font-weight:700; margin-bottom:8px;">1. í•µì‹¬ í‚¤ì›Œë“œ 3ê°œ</label>
                                <input type="text" style="width:100%; padding:12px; border:1px solid #7dd3fc; border-radius:8px;" 
                                    oninput="updateActivityState('keywords', this.value)" value="${data.keywords || ''}" placeholder="ì˜ˆ: ì–‘ì‹¬, ì •ì§, ì‹¤ì²œ">
                            </div>
                            <div style="margin-bottom:20px;">
                                <label style="display:block; font-weight:700; margin-bottom:8px;">2. ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•˜ê¸°</label>
                                <textarea style="width:100%; height:100px; border:1px solid #7dd3fc; border-radius:8px; padding:12px;" 
                                    oninput="updateActivityState('summary', this.value)" placeholder="ê¸€ì˜ ì „ì²´ ë‚´ìš©ì„ 2~3ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•´ ë³´ì„¸ìš”.">${data.summary || ''}</textarea>
                            </div>
                            <div>
                                <label style="display:block; font-weight:700; margin-bottom:8px;">3. ì´ ê¸€ì´ ì£¼ëŠ” ë„ë•ì  êµí›ˆ</label>
                                <textarea style="width:100%; height:100px; border:1px solid #7dd3fc; border-radius:8px; padding:12px;" 
                                    oninput="updateActivityState('lesson', this.value)" placeholder="ìš°ë¦¬ì˜ ì‚¶ì— ì–´ë–¤ ë©”ì‹œì§€ë¥¼ ì£¼ë‚˜ìš”?">${data.lesson || ''}</textarea>
                            </div>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
                    break;

                default:
                    body.innerHTML = `
                        <div class="activity-placeholder">
                            <i data-lucide="construction" size="48"></i>
                            <p><strong>[${strategy}] ë…ì„œ í™œë™ì§€ ì–‘ì‹ ì¤€ë¹„ ì¤‘</strong><br>ì„±ì·¨ê¸°ì¤€ì— ë§ì¶° í™œë™ ë‚´ìš©ì„ ì„¤ê³„í•´ ì£¼ì„¸ìš”.</p>
                            <textarea style="width:100%; height:200px; margin-top:20px; border-radius:12px; border:1px solid #cbd5e1; padding:15px;" 
                                oninput="updateActivityState('text', this.value)" placeholder="í™œë™ ê³„íš ë˜ëŠ” ê²°ê³¼ë¬¼ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.">${data.text || ''}</textarea>
                        </div>
                    `;
                    saveBtn.onclick = () => saveActivityData(stdId, strategy, eventId);
            }
            lucide.createIcons();
        }

        function saveActivityData(stdId, strategy, eventId) {
            // ë°ì´í„° êµ¬ì¡°: stdId -> { eventId -> { strategy, data } }
            if (!activityDataStore[stdId] || !activityDataStore[stdId][eventId]) {
                alert('ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
                return;
            }

            const context = activityDataStore[stdId][eventId];
            const data = context.data;

            const std = allStandards.find(s => s.id === stdId);
            if (!std) return;

            const table = document.getElementById(`detail-plan-table-${std.code}`);
            if (table) {
                // íŠ¹ì • ì‚¬íƒœ IDë¥¼ ê°€ì§„ í–‰ë§Œ íƒ€ê²ŸíŒ… (data-event-id ì†ì„± í™œìš©)
                const row = table.querySelector(`tr[data-event-id="${eventId}"]`);
                if (row) {
                    const activityCell = row.cells[2]; // êµìˆ˜Â·í•™ìŠµ í™œë™ ì¹¸

                    let resultHtml = `<div class="activity-result-box" style="margin-top:15px; padding:16px; background:#f8fafc; border:1.5px solid var(--vol-1); border-radius:12px; font-size:0.9rem; color:#1e293b; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05);">`;
                    resultHtml += `<div style="display:flex; align-items:center; gap:8px; margin-bottom:10px; color:var(--vol-1); font-weight:800;">
                        <i data-lucide="check-circle" size="16"></i> ë…ì„œ í™œë™ ê²°ê³¼: ${strategy}
                    </div>`;

                    switch (strategy) {
                        case 'KWL':
                            resultHtml += `<div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; font-size:0.85rem;">
                                    <div style="background:#fff; padding:8px; border-radius:6px; border:1px solid #eee;"><strong>[K]</strong> ${data.k || '-'}</div>
                                    <div style="background:#fff; padding:8px; border-radius:6px; border:1px solid #eee;"><strong>[W]</strong> ${data.w || '-'}</div>
                                    <div style="background:#fff; padding:8px; border-radius:6px; border:1px solid #eee;"><strong>[L]</strong> ${data.l || '-'}</div>
                                </div>`;
                            break;
                        case 'SQ3R':
                            resultHtml += `<div style="line-height:1.5;">
                                    <strong>[S]</strong> ${data.s || '-'}<br><strong>[Q]</strong> ${data.q || '-'}<br>
                                    <strong>[R1]</strong> ${data.r1 || '-'}<br><strong>[R2]</strong> ${data.r2 || '-'}<br><strong>[R3]</strong> ${data.r3 || '-'}
                                </div>`;
                            break;
                        case 'ë§ˆì¸ë“œë§µ':
                            resultHtml += `<div style="line-height:1.5;">
                                    <strong>ì£¼ì œ:</strong> ${data.center || '-'}<br>
                                    <strong>í•µì‹¬:</strong> ${data.b1 || '-'} | <strong>ì„¸ë¶€:</strong> ${data.b2 || '-'}<br>
                                    <strong>ì‚¬ë¡€:</strong> ${data.b3 || '-'} | <strong>ìƒê°:</strong> ${data.b4 || '-'}
                                </div>`;
                            break;
                        case 'ì‚¬ê±´ íë¦„ë„':
                            resultHtml += `<div style="display:flex; align-items:center; gap:5px; font-size:0.85rem; flex-wrap:wrap;">
                                <span style="background:#f3e8ff; padding:2px 6px; border-radius:4px;">ë°œë‹¨: ${data.start || '-'}</span> â†’ 
                                <span style="background:#f3e8ff; padding:2px 6px; border-radius:4px;">ì „ê°œ: ${data.process || '-'}</span> â†’ 
                                <span style="background:#f3e8ff; padding:2px 6px; border-radius:4px;">ê²°ë§: ${data.end || '-'}</span>
                            </div>`;
                            break;
                        case 'ì›ì¸ê³¼ ê²°ê³¼':
                            resultHtml += `<strong>[ì›ì¸]</strong> ${data.cause || '-'}<br><strong>[ê²°ê³¼]</strong> ${data.effect || '-'}`;
                            break;
                        case 'ë¹„êµì™€ ëŒ€ì¡°':
                            resultHtml += `<div style="line-height:1.5;">
                                <strong>${data.targetA || 'A'}:</strong> ${data.a || '-'}<br>
                                <strong>${data.targetB || 'B'}:</strong> ${data.b || '-'}<br>
                                <strong>ê³µí†µ:</strong> ${data.common || '-'}
                            </div>`;
                            break;
                        case 'ìºë¦­í„° ì°¨íŠ¸':
                            resultHtml += `<div style="line-height:1.6;">
                                    <strong>ì¸ë¬¼:</strong> ${data.name || '-'}<br>
                                    <strong>íŠ¹ì§•:</strong> ${data.trait || '-'}<br>
                                    <strong>í–‰ë™:</strong> ${data.action || '-'}<br>
                                    <strong>ìƒê°:</strong> ${data.eval || '-'}
                                </div>`;
                            break;
                        case 'QAR':
                            resultHtml += `<div style="line-height:1.6;">
                                    <strong>Q (${data.type || 'ìœ í˜•ë¯¸ì§€ì •'}):</strong> ${data.q || '-'}<br>
                                    <strong>A:</strong> ${data.a || '-'}
                                </div>`;
                            break;
                        case 'ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°':
                            resultHtml += `<div style="line-height:1.6;">
                                    <strong>ì˜ˆì¸¡:</strong> ${data.p1 || '-'}<br>
                                    <strong>ê·¼ê±°:</strong> ${data.p2 || '-'}
                                </div>`;
                            break;
                        case 'ìš”ì•½í•˜ê¸°':
                            resultHtml += `<div style="line-height:1.6;">
                                    <strong>í•µì‹¬ë‹¨ì–´:</strong> ${data.keywords || '-'}<br>
                                    <strong>ìš”ì•½:</strong> ${data.summary || '-'}<br>
                                    <strong>êµí›ˆ:</strong> ${data.lesson || '-'}
                                </div>`;
                            break;
                        default:
                            resultHtml += `<div style="white-space:pre-wrap;">${data.text || 'ë‚´ìš© ì—†ìŒ'}</div>`;
                    }
                    resultHtml += `</div>`;

                    // ê¸°ì¡´ ë™ì¼í•œ ì‚¬íƒœ ë‚´ì˜ ê²°ê³¼ ë°•ìŠ¤ê°€ ìˆìœ¼ë©´ êµì²´, ì—†ìœ¼ë©´ ì¶”ê°€
                    const oldBox = activityCell.querySelector('.activity-result-box');
                    if (oldBox) oldBox.remove();

                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = resultHtml;
                    activityCell.appendChild(tempDiv.firstChild);
                }
            }

            alert(`${strategy} í™œë™ì´ í•´ë‹¹ ìˆ˜ì—… ì‚¬íƒœì— ì„±ê³µì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            closeActivityModal();
            lucide.createIcons();
        }

        // --- WORKSHEET DROPDOWN FUNCTIONS ---
        function toggleWorksheetDropdown(event) {
            event.stopPropagation();
            const menu = document.getElementById('ws-dropdown-menu');
            menu.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        window.addEventListener('click', function (e) {
            const menu = document.getElementById('ws-dropdown-menu');
            if (menu && menu.classList.contains('active')) {
                if (!e.target.closest('.ws-dropdown-container')) {
                    menu.classList.remove('active');
                }
            }
        });

        function closeWsDropdown() {
            const menu = document.getElementById('ws-dropdown-menu');
            if (menu) menu.classList.remove('active');
        }

        function copyWorksheetTable() {
            closeWsDropdown();
            // í•™ìŠµì§€ ë Œë”ë§ì„ ìœ„í•´ ì„ì‹œë¡œ ì¶œë ¥ ì˜ì—­ í‘œì‹œ
            const printArea = document.getElementById('worksheet-print-area');
            const stdInfo = document.getElementById('ws-std-info');
            const wsBody = document.getElementById('ws-body');

            if (basket.size === 0) {
                alert('ë°”êµ¬ë‹ˆì— ì„±ì·¨ê¸°ì¤€ì„ ë‹´ì€ í›„ ì§„í–‰í•˜ì„¸ìš”.');
                return;
            }

            wsBody.innerHTML = '';
            stdInfo.innerHTML = '';

            const selectedStds = Array.from(basket).map(id => allStandards.find(s => s.id === id)).filter(Boolean);
            let headerHtml = '<div style="border:2px solid #000; padding:15px; margin-bottom:20px; font-family:\'Malgun Gothic\';">';
            selectedStds.forEach(std => {
                const areaName = std.areaId ? AREA_MAP[std.areaId].fullName : 'ê¸°íƒ€ ë‹¨ì›';
                headerHtml += `<div style="margin-bottom:8px;"><strong>ë‹¨ì›:</strong> ${areaName} | <strong>ì„±ì·¨ê¸°ì¤€:</strong> [${std.code}] ${std.definition}</div>`;
            });
            headerHtml += '</div>';
            stdInfo.innerHTML = headerHtml;

            let hasActivity = false;
            selectedStds.forEach(std => {
                GAGNE_EVENTS.forEach(event => {
                    const activity = activityDataStore[std.id] && activityDataStore[std.id][event.id];
                    if (activity && activity.strategy) {
                        hasActivity = true;
                        const strategy = activity.strategy;
                        const data = activity.data || {};

                        // HWP loves Tables for layout retention
                        let sectionHtml = `
                            <table style="width:100%; border-collapse:collapse; margin-bottom:25px; border:1px solid #000; font-family:'Malgun Gothic';">
                                <tr>
                                    <td style="padding:12px; background:#f1f5f9; border:1px solid #000; font-weight:bold; font-size:1.1rem;">
                                        [${strategy} í™œë™]
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:20px; border:1px solid #000; background:#fff; line-height:1.6;">
                                        ${getStrategyWorksheetHtml(strategy, data)}
                                    </td>
                                </tr>
                            </table>
                        `;
                        wsBody.insertAdjacentHTML('beforeend', sectionHtml);
                    }
                });
            });

            if (!hasActivity) {
                alert('ì•„ì§ ì„ íƒëœ ë…ì„œ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤. ì§€ë„ì•ˆì˜ [ë…ì„œ ì¤‘ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸]ì—ì„œ ì „ëµì„ í´ë¦­í•˜ì—¬ í™œë™ ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                return;
            }

            printArea.style.display = 'block';

            const range = document.createRange();
            range.selectNode(printArea);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);

            try {
                const success = document.execCommand('copy');
                if (success) {
                    alert('í•™ìŠµì§€ í‘œ ì–‘ì‹ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•œê¸€(HWP)ì´ë‚˜ ì›Œë“œì— [ì›ë³¸ ì„œì‹ ìœ ì§€]ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
                    closeWsChoiceModal();
                }
            } catch (err) {
                alert('ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }

            window.getSelection().removeAllRanges();
            printArea.style.display = 'none';
        }

        async function downloadWorksheetPDF() {
            closeWsDropdown(); // Close dropdown before starting
            const printArea = document.getElementById('worksheet-print-area');
            const stdInfo = document.getElementById('ws-std-info');
            const wsBody = document.getElementById('ws-body');

            if (basket.size === 0) {
                alert('ë°”êµ¬ë‹ˆì— ì„±ì·¨ê¸°ì¤€ì„ ë‹´ì€ í›„ í•™ìŠµì§€ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
                return;
            }

            wsBody.innerHTML = '';
            stdInfo.innerHTML = '';

            const selectedStds = Array.from(basket).map(id => allStandards.find(s => s.id === id)).filter(Boolean);

            let headerHtml = '';
            selectedStds.forEach(std => {
                const areaName = std.areaId ? AREA_MAP[std.areaId].fullName : 'ê¸°íƒ€ ë‹¨ì›';
                headerHtml += `<div style="margin-bottom:8px;"><strong>ë‹¨ì›:</strong> ${areaName} | <strong>ì„±ì·¨ê¸°ì¤€:</strong> [${std.code}] ${std.definition}</div>`;
            });
            stdInfo.innerHTML = headerHtml;

            let hasActivity = false;
            selectedStds.forEach(std => {
                GAGNE_EVENTS.forEach(event => {
                    const activity = activityDataStore[std.id] && activityDataStore[std.id][event.id];
                    // 'í™œë™ ë°ì´í„°ê°€ ìˆê±°ë‚˜' ë˜ëŠ” 'í•´ë‹¹ ì‚¬íƒœì— ì „ëµì´ í• ë‹¹ë˜ì–´ ìˆìœ¼ë©´' (ë¹ˆ ì¹¸ì´ë¼ë„) í¬í•¨
                    if (activity && activity.strategy) {
                        hasActivity = true;
                        const strategy = activity.strategy;
                        const data = activity.data || {};

                        let sectionHtml = `
                            <div class="ws-section" style="border-bottom:1px dashed #e2e8f0; padding-bottom:20px; margin-bottom:20px;">
                                <div class="ws-section-title">
                                    <img src="image_6bbae2.png" style="width:36px; height:36px; object-fit:contain; margin-right:8px;" onerror="this.style.display='none'">
                                    <i data-lucide="${getStrategyIcon(strategy)}" style="color:var(--vol-1); width:24px; height:24px;"></i>
                                    <span style="margin-left:5px;">${strategy} í™œë™</span>
                                </div>
                                <div class="ws-content-box" style="background:#fff; border:1px solid #cbd5e1;">
                                    ${getStrategyWorksheetHtml(strategy, data)}
                                </div>
                            </div>
                        `;
                        wsBody.insertAdjacentHTML('beforeend', sectionHtml);
                    }
                });
            });

            if (!hasActivity) {
                alert('ì•„ì§ ì„ íƒëœ ë…ì„œ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤. ì§€ë„ì•ˆì˜ [ë…ì„œ ì¤‘ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸]ì—ì„œ ì „ëµì„ í´ë¦­í•˜ì—¬ í™œë™ ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                return;
            }

            printArea.style.display = 'block';
            lucide.createIcons();

            const options = {
                margin: [10, 10, 10, 10],
                filename: 'ë„ë•ê³¼_ë…ì„œí™œë™_í•™ìŠµì§€.pdf',
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: {
                    scale: 3,
                    useCORS: true,
                    logging: false,
                    allowTaint: true,
                    letterRendering: true
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            try {
                // ì•„ì´ì½˜ ë° ì´ë¯¸ì§€ ë Œë”ë§ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì¶©ë¶„íˆ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 1000));
                await html2pdf().set(options).from(printArea).save();
            } catch (err) {
                console.error('PDF Download Error:', err);
                alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                printArea.style.display = 'none';
            }
        }

        function getStrategyIcon(strategy) {
            const icons = {
                'KWL': 'brain',
                'ìºë¦­í„° ì°¨íŠ¸': 'user',
                'QAR': 'help-circle',
                'ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°': 'eye',
                'ìš”ì•½í•˜ê¸°': 'feather',
                'SQ3R': 'clipboard-list',
                'ë§ˆì¸ë“œë§µ': 'share-2',
                'ì‚¬ê±´ íë¦„ë„': 'play-circle',
                'ì›ì¸ê³¼ ê²°ê³¼': 'git-branch',
                'ë¹„êµì™€ ëŒ€ì¡°': 'intersect'
            };
            return icons[strategy] || 'book-open';
        }

        function getStrategyWorksheetHtml(strategy, data) {
            let html = '';
            switch (strategy) {
                case 'KWL':
                    html += `<div class="ws-label">[K] ì•Œê³  ìˆëŠ” ê²ƒ</div><div class="ws-text">${data.k || ''}</div>`;
                    html += `<div class="ws-label">[W] ì•Œê³  ì‹¶ì€ ê²ƒ</div><div class="ws-text">${data.w || ''}</div>`;
                    html += `<div class="ws-label">[L] ìƒˆë¡œ ë°°ìš´ ê²ƒ</div><div class="ws-text">${data.l || ''}</div>`;
                    break;
                case 'SQ3R':
                    html += `<div class="ws-label">[S] í›‘ì–´ë³´ê¸°</div><div class="ws-text">${data.s || ''}</div>`;
                    html += `<div class="ws-label">[Q] ì§ˆë¬¸í•˜ê¸°</div><div class="ws-text">${data.q || ''}</div>`;
                    html += `<div class="ws-label">[R1] ì½ê¸°</div><div class="ws-text">${data.r1 || ''}</div>`;
                    html += `<div class="ws-label">[R2] ì•”ì†¡í•˜ê¸°</div><div class="ws-text">${data.r2 || ''}</div>`;
                    html += `<div class="ws-label">[R3] ë³µìŠµí•˜ê¸°</div><div class="ws-text">${data.r3 || ''}</div>`;
                    break;
                case 'ë§ˆì¸ë“œë§µ':
                    html += `<div class="ws-label">ì¤‘ì‹¬ ì£¼ì œ: ${data.center || ''}</div>`;
                    html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:10px;">
                        <div><div class="ws-label">1. í•µì‹¬ë‚´ìš©</div><div class="ws-text">${data.b1 || ''}</div></div>
                        <div><div class="ws-label">2. ì„¸ë¶€ì‚¬í•­</div><div class="ws-text">${data.b2 || ''}</div></div>
                        <div><div class="ws-label">3. ê´€ë ¨ì‚¬ë¡€</div><div class="ws-text">${data.b3 || ''}</div></div>
                        <div><div class="ws-label">4. ë‚˜ì˜ìƒê°</div><div class="ws-text">${data.b4 || ''}</div></div>
                    </div>`;
                    break;
                case 'ì‚¬ê±´ íë¦„ë„':
                    html += `<div class="ws-label">[ë°œë‹¨]</div><div class="ws-text">${data.start || ''}</div>`;
                    html += `<div class="ws-label">[ì „ê°œ]</div><div class="ws-text">${data.process || ''}</div>`;
                    html += `<div class="ws-label">[ê²°ë§]</div><div class="ws-text">${data.end || ''}</div>`;
                    break;
                case 'ì›ì¸ê³¼ ê²°ê³¼':
                    html += `<div class="ws-label">[ì›ì¸] ì™œ ì¼ì–´ë‚¬ë‚˜ìš”?</div><div class="ws-text">${data.cause || ''}</div>`;
                    html += `<div class="ws-label">[ê²°ê³¼] ì–´ë–¤ ì¼ì´ ìƒê²¼ë‚˜ìš”?</div><div class="ws-text">${data.effect || ''}</div>`;
                    break;
                case 'ë¹„êµì™€ ëŒ€ì¡°':
                    html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                        <div><div class="ws-label">ëŒ€ìƒ A: ${data.targetA || ''}</div><div class="ws-text">${data.a || ''}</div></div>
                        <div><div class="ws-label">ëŒ€ìƒ B: ${data.targetB || ''}</div><div class="ws-text">${data.b || ''}</div></div>
                    </div>`;
                    html += `<div class="ws-label">ê³µí†µì </div><div class="ws-text">${data.common || ''}</div>`;
                    break;
                case 'ìºë¦­í„° ì°¨íŠ¸':
                    html += `<div class="ws-label">ì¸ë¬¼ ì´ë¦„: ${data.name || ''}</div>`;
                    html += `<div class="ws-label">ì„±ê²© ë° íŠ¹ì§•</div><div class="ws-text">${data.trait || ''}</div>`;
                    html += `<div class="ws-label">ì£¼ìš” ëŒ€ì‚¬/í–‰ë™</div><div class="ws-text">${data.action || ''}</div>`;
                    html += `<div class="ws-label">ë‚˜ì˜ í‰ê°€</div><div class="ws-text">${data.eval || ''}</div>`;
                    break;
                case 'QAR':
                    html += `<div class="ws-label">ì§ˆë¬¸ (${data.type || ''})</div><div class="ws-text">${data.q || ''}</div>`;
                    html += `<div class="ws-label">ë‹µë³€</div><div class="ws-text">${data.a || ''}</div>`;
                    break;
                case 'ì˜ˆì¸¡ ì•ˆë‚´í•˜ê¸°':
                    html += `<div class="ws-label">ì˜ˆìƒë˜ëŠ” ë‚´ìš©</div><div class="ws-text">${data.p1 || ''}</div>`;
                    html += `<div class="ws-label">ê·¸ë ‡ê²Œ ìƒê°í•œ ê·¼ê±°</div><div class="ws-text">${data.p2 || ''}</div>`;
                    break;
                case 'ìš”ì•½í•˜ê¸°':
                    html += `<div class="ws-label">í•µì‹¬ í‚¤ì›Œë“œ</div><div class="ws-text">${data.keywords || ''}</div>`;
                    html += `<div class="ws-label">ë¬¸ì¥ ìš”ì•½</div><div class="ws-text">${data.summary || ''}</div>`;
                    html += `<div class="ws-label">ë„ë•ì  êµí›ˆ</div><div class="ws-text">${data.lesson || ''}</div>`;
                    break;
                default:
                    html += `<div class="ws-text">${data.text || ''}</div>`;
            }
            return html;
        }

        setTimeout(initData, 100);

    </script>
</body>

</html>